# 9.2. try-catch-finally를 이용한 예외 처리

## 학습 목표
- try-catch-finally 문법을 이해하고 사용한다
- 다양한 예외 처리 패턴을 익힌다
- JavaScript의 try-catch와 Java의 차이를 비교한다
- 사용자 정의 예외를 만들고 활용한다
- throws 키워드로 예외를 전파한다

---

## 1. try-catch 기본 문법

### 1.1. 기본 구조

```java
try {
    // 예외가 발생할 수 있는 코드
} catch (ExceptionType e) {
    // 예외 발생 시 실행되는 코드
}
```

### 1.2. 기본 예제

```java
public class Main {
    public static void main(String[] args) {
        try {
            int result = 10 / 0;  // ArithmeticException 발생
            System.out.println("결과: " + result);
        } catch (ArithmeticException e) {
            System.out.println("0으로 나눌 수 없습니다.");
        }

        System.out.println("프로그램 계속 실행");
    }
}
```

**출력:**
```
0으로 나눌 수 없습니다.
프로그램 계속 실행
```

**JavaScript 비교:**
```javascript
try {
    const result = someUndefinedFunction();
    console.log("결과:", result);
} catch (error) {
    console.log("오류 발생:", error.message);
}

console.log("프로그램 계속 실행");
```

---

## 2. 실행 흐름

### 2.1. 예외가 발생한 경우

```java
public class Main {
    public static void main(String[] args) {
        System.out.println("1. 시작");

        try {
            System.out.println("2. try 블록 진입");
            int result = 10 / 0;  // 예외 발생!
            System.out.println("3. 이 코드는 실행 안됨");
        } catch (ArithmeticException e) {
            System.out.println("4. catch 블록 실행");
        }

        System.out.println("5. try-catch 이후 계속 실행");
    }
}
```

**출력:**
```
1. 시작
2. try 블록 진입
4. catch 블록 실행
5. try-catch 이후 계속 실행
```

### 2.2. 예외가 발생하지 않은 경우

```java
public class Main {
    public static void main(String[] args) {
        System.out.println("1. 시작");

        try {
            System.out.println("2. try 블록 진입");
            int result = 10 / 2;  // 정상 실행
            System.out.println("3. 결과: " + result);
        } catch (ArithmeticException e) {
            System.out.println("4. 이 코드는 실행 안됨");
        }

        System.out.println("5. try-catch 이후 계속 실행");
    }
}
```

**출력:**
```
1. 시작
2. try 블록 진입
3. 결과: 5
5. try-catch 이후 계속 실행
```

---

## 3. 다중 catch 블록

### 3.1. 여러 예외 처리

```java
public class Main {
    public static void main(String[] args) {
        String[] words = {"10", "20", "abc", "40"};

        for (String word : words) {
            try {
                int num = Integer.parseInt(word);
                int result = 100 / num;
                System.out.println("100 / " + num + " = " + result);
            } catch (NumberFormatException e) {
                System.out.println("'" + word + "'는 숫자가 아닙니다.");
            } catch (ArithmeticException e) {
                System.out.println("0으로 나눌 수 없습니다.");
            }
        }
    }
}
```

**출력:**
```
100 / 10 = 10
100 / 20 = 5
'abc'는 숫자가 아닙니다.
100 / 40 = 2
```

### 3.2. catch 블록 순서 주의

```java
// ❌ 잘못된 순서 (컴파일 에러)
try {
    // ...
} catch (Exception e) {  // 모든 예외를 잡아버림
    // ...
} catch (ArithmeticException e) {  // 도달 불가능한 코드!
    // ...
}

// ✅ 올바른 순서
try {
    // ...
} catch (ArithmeticException e) {  // 구체적인 예외 먼저
    // ...
} catch (Exception e) {  // 일반적인 예외 나중
    // ...
}
```

**규칙:** 자식 예외 클래스를 먼저, 부모 예외 클래스를 나중에 배치

---

## 4. 멀티 catch (Java 7+)

### 4.1. 여러 예외를 하나로 처리

```java
// ❌ 중복 코드
try {
    // ...
} catch (NumberFormatException e) {
    System.out.println("입력 오류: " + e.getMessage());
} catch (NullPointerException e) {
    System.out.println("입력 오류: " + e.getMessage());
}

// ✅ 멀티 catch
try {
    // ...
} catch (NumberFormatException | NullPointerException e) {
    System.out.println("입력 오류: " + e.getMessage());
}
```

### 4.2. 실전 예제

```java
import java.util.Scanner;

public class Main {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        System.out.print("숫자 입력: ");
        String input = scanner.nextLine();

        try {
            int num = Integer.parseInt(input);
            int result = 100 / num;
            System.out.println("결과: " + result);
        } catch (NumberFormatException | ArithmeticException e) {
            System.out.println("잘못된 입력입니다: " + e.getMessage());
        }
    }
}
```

**주의사항:**
- 멀티 catch의 예외들은 상속 관계면 안됨
- `Exception | ArithmeticException`은 컴파일 에러

---

## 5. finally 블록

### 5.1. 개념

**finally 블록**은 예외 발생 여부와 관계없이 **반드시 실행**되는 코드 블록입니다.

```java
try {
    // 예외 발생 가능 코드
} catch (Exception e) {
    // 예외 처리
} finally {
    // 항상 실행되는 코드
}
```

### 5.2. 기본 예제

```java
public class Main {
    public static void main(String[] args) {
        try {
            System.out.println("1. try 블록");
            int result = 10 / 0;  // 예외 발생
            System.out.println("2. 실행 안됨");
        } catch (ArithmeticException e) {
            System.out.println("3. catch 블록");
        } finally {
            System.out.println("4. finally 블록 (항상 실행)");
        }

        System.out.println("5. 이후 코드");
    }
}
```

**출력:**
```
1. try 블록
3. catch 블록
4. finally 블록 (항상 실행)
5. 이후 코드
```

### 5.3. return이 있어도 finally 실행

```java
public class Main {
    public static void main(String[] args) {
        String result = testMethod();
        System.out.println("결과: " + result);
    }

    static String testMethod() {
        try {
            System.out.println("try 블록");
            return "try에서 반환";
        } catch (Exception e) {
            System.out.println("catch 블록");
            return "catch에서 반환";
        } finally {
            System.out.println("finally 블록 (return 전에 실행)");
        }
    }
}
```

**출력:**
```
try 블록
finally 블록 (return 전에 실행)
결과: try에서 반환
```

### 5.4. 실전 활용 - 리소스 정리

```java
import java.io.*;

public class Main {
    public static void main(String[] args) {
        FileReader file = null;

        try {
            file = new FileReader("test.txt");
            // 파일 읽기 작업
        } catch (IOException e) {
            System.out.println("파일 오류: " + e.getMessage());
        } finally {
            // 파일 닫기 (반드시 실행)
            if (file != null) {
                try {
                    file.close();
                    System.out.println("파일 닫기 완료");
                } catch (IOException e) {
                    System.out.println("파일 닫기 실패");
                }
            }
        }
    }
}
```

**JavaScript 비교:**
```javascript
try {
    // 코드
} catch (error) {
    // 예외 처리
} finally {
    // 항상 실행 (JavaScript도 동일)
}
```

---

## 6. try-with-resources (Java 7+)

### 6.1. 자동 리소스 관리

finally에서 수동으로 리소스를 닫는 대신, **자동으로 관리**할 수 있습니다.

```java
// ❌ 복잡한 방식 (수동 close)
FileReader file = null;
try {
    file = new FileReader("test.txt");
    // 읽기 작업
} catch (IOException e) {
    e.printStackTrace();
} finally {
    if (file != null) {
        try {
            file.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

// ✅ 간결한 방식 (자동 close)
try (FileReader file = new FileReader("test.txt")) {
    // 읽기 작업
} catch (IOException e) {
    e.printStackTrace();
}
// 자동으로 file.close() 호출됨
```

### 6.2. 여러 리소스 관리

```java
try (
    FileReader input = new FileReader("input.txt");
    FileWriter output = new FileWriter("output.txt")
) {
    // 작업 수행
} catch (IOException e) {
    e.printStackTrace();
}
// input, output 모두 자동으로 close됨
```

---

## 7. 예외 정보 확인

### 7.1. 주요 메서드

```java
try {
    int result = 10 / 0;
} catch (ArithmeticException e) {
    // 1. getMessage(): 예외 메시지만
    System.out.println("메시지: " + e.getMessage());

    // 2. toString(): 예외 타입 + 메시지
    System.out.println("toString: " + e.toString());

    // 3. printStackTrace(): 전체 스택 트레이스
    e.printStackTrace();
}
```

**출력:**
```
메시지: / by zero
toString: java.lang.ArithmeticException: / by zero
java.lang.ArithmeticException: / by zero
    at Main.main(Main.java:4)
```

### 7.2. 실전 예제 - 로깅

```java
import java.util.logging.*;

public class Main {
    private static final Logger logger = Logger.getLogger(Main.class.getName());

    public static void main(String[] args) {
        try {
            int result = 10 / 0;
        } catch (ArithmeticException e) {
            // 로그 남기기
            logger.severe("계산 오류 발생: " + e.getMessage());

            // 사용자에게 친절한 메시지
            System.out.println("계산 중 오류가 발생했습니다.");
        }
    }
}
```

---

## 8. throw - 예외 발생시키기

### 8.1. 의도적으로 예외 던지기

```java
public class Main {
    public static void main(String[] args) {
        try {
            validateAge(-5);
        } catch (IllegalArgumentException e) {
            System.out.println("오류: " + e.getMessage());
        }
    }

    static void validateAge(int age) {
        if (age < 0) {
            throw new IllegalArgumentException("나이는 음수일 수 없습니다.");
        }
        if (age > 150) {
            throw new IllegalArgumentException("나이가 너무 큽니다.");
        }
        System.out.println("유효한 나이: " + age);
    }
}
```

**출력:**
```
오류: 나이는 음수일 수 없습니다.
```

### 8.2. 실전 예제 - 입력 검증

```java
public class User {
    private String email;
    private int age;

    public User(String email, int age) {
        setEmail(email);
        setAge(age);
    }

    public void setEmail(String email) {
        if (email == null || email.isEmpty()) {
            throw new IllegalArgumentException("이메일은 필수입니다.");
        }
        if (!email.contains("@")) {
            throw new IllegalArgumentException("올바른 이메일 형식이 아닙니다.");
        }
        this.email = email;
    }

    public void setAge(int age) {
        if (age < 0 || age > 150) {
            throw new IllegalArgumentException("나이는 0~150 사이여야 합니다.");
        }
        this.age = age;
    }
}

public class Main {
    public static void main(String[] args) {
        try {
            User user1 = new User("test@example.com", 25);
            System.out.println("사용자 생성 성공");

            User user2 = new User("invalid-email", 25);  // 예외 발생
        } catch (IllegalArgumentException e) {
            System.out.println("생성 실패: " + e.getMessage());
        }
    }
}
```

**JavaScript 비교:**
```javascript
class User {
    constructor(email, age) {
        this.setEmail(email);
        this.setAge(age);
    }

    setEmail(email) {
        if (!email || !email.includes('@')) {
            throw new Error("올바른 이메일 형식이 아닙니다.");
        }
        this.email = email;
    }

    setAge(age) {
        if (age < 0 || age > 150) {
            throw new Error("나이는 0~150 사이여야 합니다.");
        }
        this.age = age;
    }
}
```

---

## 9. throws - 예외 전파

### 9.1. 예외를 호출자에게 전달

```java
public class Main {
    public static void main(String[] args) {
        try {
            readFile("test.txt");
        } catch (IOException e) {
            System.out.println("파일 오류: " + e.getMessage());
        }
    }

    // throws로 예외를 main에게 전달
    static void readFile(String filename) throws IOException {
        FileReader file = new FileReader(filename);
        // 파일 읽기
        file.close();
    }
}
```

### 9.2. 여러 예외 선언

```java
public void process(String filename) throws IOException, SQLException {
    // 파일 작업
    FileReader file = new FileReader(filename);

    // 데이터베이스 작업
    Connection conn = DriverManager.getConnection("...");
}
```

### 9.3. throws vs try-catch

```java
// 방법 1: throws로 전파
public void method1() throws Exception {
    int result = 10 / 0;  // 호출자에게 예외 전달
}

// 방법 2: try-catch로 직접 처리
public void method2() {
    try {
        int result = 10 / 0;
    } catch (ArithmeticException e) {
        System.out.println("처리함");
    }
}
```

**언제 throws를 사용할까?**
- 메서드가 예외를 처리할 적절한 방법이 없을 때
- 호출자가 예외를 더 잘 처리할 수 있을 때
- API 메서드에서 예외 가능성을 명시할 때

---

## 10. 사용자 정의 예외

### 10.1. 기본 사용자 정의 예외

```java
// 커스텀 예외 클래스
public class InvalidAgeException extends Exception {
    public InvalidAgeException(String message) {
        super(message);
    }
}

// 사용
public class User {
    private int age;

    public void setAge(int age) throws InvalidAgeException {
        if (age < 0 || age > 150) {
            throw new InvalidAgeException("유효하지 않은 나이: " + age);
        }
        this.age = age;
    }
}

public class Main {
    public static void main(String[] args) {
        User user = new User();

        try {
            user.setAge(-5);
        } catch (InvalidAgeException e) {
            System.out.println("오류: " + e.getMessage());
        }
    }
}
```

### 10.2. 추가 정보를 가진 예외

```java
public class InsufficientBalanceException extends RuntimeException {
    private final int balance;
    private final int requestedAmount;

    public InsufficientBalanceException(int balance, int requestedAmount) {
        super(String.format("잔액 부족: 현재 %d원, 요청 %d원", balance, requestedAmount));
        this.balance = balance;
        this.requestedAmount = requestedAmount;
    }

    public int getBalance() {
        return balance;
    }

    public int getRequestedAmount() {
        return requestedAmount;
    }

    public int getShortfall() {
        return requestedAmount - balance;
    }
}

// 사용
public class BankAccount {
    private int balance;

    public BankAccount(int balance) {
        this.balance = balance;
    }

    public void withdraw(int amount) {
        if (amount > balance) {
            throw new InsufficientBalanceException(balance, amount);
        }
        balance -= amount;
        System.out.println(amount + "원 출금 완료");
    }
}

public class Main {
    public static void main(String[] args) {
        BankAccount account = new BankAccount(10000);

        try {
            account.withdraw(15000);
        } catch (InsufficientBalanceException e) {
            System.out.println("오류: " + e.getMessage());
            System.out.println("부족액: " + e.getShortfall() + "원");
        }
    }
}
```

**출력:**
```
오류: 잔액 부족: 현재 10000원, 요청 15000원
부족액: 5000원
```

### 10.3. RuntimeException vs Exception

```java
// Unchecked 예외 (처리 선택)
public class CustomRuntimeException extends RuntimeException {
    public CustomRuntimeException(String message) {
        super(message);
    }
}

// Checked 예외 (처리 필수)
public class CustomCheckedException extends Exception {
    public CustomCheckedException(String message) {
        super(message);
    }
}
```

**권장사항:** 요즘은 대부분 RuntimeException을 상속받습니다 (Unchecked).

---

## 11. 실전 예제

### 예제 1: 계산기

```java
public class Calculator {
    public double divide(double a, double b) {
        if (b == 0) {
            throw new ArithmeticException("0으로 나눌 수 없습니다.");
        }
        return a / b;
    }

    public int parseInt(String str) {
        try {
            return Integer.parseInt(str);
        } catch (NumberFormatException e) {
            System.out.println("'" + str + "'는 숫자가 아닙니다. 0을 반환합니다.");
            return 0;
        }
    }
}

public class Main {
    public static void main(String[] args) {
        Calculator calc = new Calculator();

        // 정상 케이스
        System.out.println("10 / 2 = " + calc.divide(10, 2));

        // 예외 케이스
        try {
            calc.divide(10, 0);
        } catch (ArithmeticException e) {
            System.out.println("오류: " + e.getMessage());
        }

        // 파싱 예외
        int num = calc.parseInt("abc");
        System.out.println("파싱 결과: " + num);
    }
}
```

### 예제 2: 파일 처리

```java
import java.io.*;
import java.util.*;

public class FileProcessor {
    public List<String> readLines(String filename) {
        List<String> lines = new ArrayList<>();

        try (BufferedReader reader = new BufferedReader(new FileReader(filename))) {
            String line;
            while ((line = reader.readLine()) != null) {
                lines.add(line);
            }
            System.out.println(lines.size() + "줄 읽기 완료");
        } catch (FileNotFoundException e) {
            System.out.println("파일을 찾을 수 없습니다: " + filename);
        } catch (IOException e) {
            System.out.println("파일 읽기 오류: " + e.getMessage());
        }

        return lines;
    }
}
```

---

## 12. 정리

### 핵심 문법

```java
// 기본 형태
try {
    // 예외 발생 가능 코드
} catch (ExceptionType1 e) {
    // 예외 처리 1
} catch (ExceptionType2 e) {
    // 예외 처리 2
} finally {
    // 항상 실행
}

// 멀티 catch
try {
    // ...
} catch (Exception1 | Exception2 e) {
    // 동일한 처리
}

// try-with-resources
try (Resource res = new Resource()) {
    // 자동 close
}

// 예외 던지기
throw new ExceptionType("message");

// 예외 전파
public void method() throws ExceptionType {
    // ...
}
```

### JavaScript vs Java

| 특징 | JavaScript | Java |
|------|-----------|------|
| 기본 문법 | `try-catch-finally` | `try-catch-finally` |
| 예외 타입 | Error 하나 | 다양한 Exception |
| 멀티 catch | ❌ 없음 | ✅ 있음 (`\|`) |
| 리소스 관리 | 수동 | try-with-resources |
| 예외 전파 | 명시 불필요 | throws 키워드 |

### 다음 단계

9장을 완료했습니다! 이제 **미니 프로젝트**로 배운 내용을 종합해봅시다!

---

**다음 챕터:** [10장. 미니 프로젝트](../10_미니_프로젝트/10.1_콘솔_기반_간단한_애플리케이션_만들기.md)
