# 3.8. CASE 조건문 핵심 요약

- **`CASE` 문**: SQL 쿼리 내에서 조건부 로직을 구현하여, 조건에 따라 다른 값을 반환하게 해주는 표현식. 프로그래밍 언어의 `if-else` 또는 `switch` 문과 유사한 역할을 함.

---

### 1. `CASE` 문의 두 가지 형식

- **1. Simple CASE**
  - **용도**: 특정 열의 값이 정해진 값과 **정확히 일치**하는지 비교할 때 사용.
  - **구문**:
    ```sql
    CASE 컬럼명
        WHEN 값1 THEN 결과1
        WHEN 값2 THEN 결과2
        ELSE 기본_결과
    END
    ```

- **2. Searched CASE**
  - **용도**: 범위 비교(`>`,`<`), `LIKE`, `AND`/`OR` 등 **복잡한 조건**을 사용할 때 사용. (더 범용적)
  - **구문**:
    ```sql
    CASE
        WHEN 조건1 THEN 결과1
        WHEN 조건2 THEN 결과2
        ELSE 기본_결과
    END
    ```
  - **주의**: `WHEN` 절의 조건은 위에서부터 순서대로 평가되므로, 범위가 넓은 조건을 나중에 배치해야 함.

---

### 2. `CASE` 문의 활용

- **`SELECT` 절에서 사용**
  - **값 변환**: 특정 코드 값을 의미 있는 문자열로 변환.
    - 예: `gender` 컬럼의 'M'을 '남성'으로, 'F'를 '여성'으로 표시.
  - **데이터 분류**: 특정 기준에 따라 데이터에 등급이나 카테고리를 부여.
    - 예: `price` 값에 따라 '고가', '중가', '저가'로 분류.

- **`GROUP BY`와 함께 사용 (조건부 집계)**
  - `SUM`, `COUNT` 등 집계 함수 내에서 `CASE`를 사용하여 특정 조건에 맞는 데이터만 집계.
  - **피벗(Pivot) 테이블**과 유사한 형태로 데이터를 요약할 때 매우 유용.
  - **예시**: 성별(gender)에 따라 남성 수와 여성 수를 각각 다른 컬럼으로 집계.
    ```sql
    SELECT
        SUM(CASE WHEN gender = 'M' THEN 1 ELSE 0 END) AS male_count,
        SUM(CASE WHEN gender = 'F' THEN 1 ELSE 0 END) AS female_count
    FROM users;
    ```

- **`ORDER BY` 절에서 사용**
  - 특정 조건에 따라 정렬 순서를 동적으로 변경.
  - **예시**: 특정 값(예: '대한민국')을 항상 최상단에 위치시키고 나머지를 정렬.
    ```sql
    ORDER BY
        CASE WHEN country_name = '대한민국' THEN 0 ELSE 1 END ASC,
        population DESC;
    ```
