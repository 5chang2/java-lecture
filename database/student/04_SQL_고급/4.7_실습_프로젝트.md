# 4.7. 실습: SQL 고급 종합 프로젝트

### 1. 프로젝트 목표

- `sakila` 데이터베이스를 사용하여, 4장에서 배운 `JOIN`, 서브쿼리, 뷰, 저장 프로시저, 인덱스 등 고급 SQL 기능을 종합적으로 활용하는 실전 문제를 해결한다.
- 성능을 고려하여 쿼리를 작성하고 `EXPLAIN`으로 분석하는 능력을 기른다.

---

### 2. Mission 1: 데이터 분석 대시보드

- **시나리오**: 경영진이 비즈니스 현황을 한눈에 파악할 수 있는 핵심 지표(KPI) 대시보드를 요청했습니다.

- **과제 1-1: 전체 비즈니스 요약 뷰 (`business_summary`)**
  - 다음 정보를 포함하는 뷰를 생성하시오.
    - 전체 고객 수
    - 전체 영화 수
    - 총 대여 건수
    - 총 매출액

- **과제 1-2: 월별 매출 추이 뷰 (`monthly_revenue`)**
  - 월별 매출 정보를 제공하는 뷰를 생성하시오.
    - 연도, 월, 해당 월 매출액, 해당 월 대여 건수

- **과제 1-3: 월별 성과 조회 프로시저 (`get_monthly_performance`)**
  - 특정 연도와 월을 입력받아 아래 정보를 출력하는 저장 프로시저를 작성하시오.
    - 해당 월 매출액
    - 전월 대비 매출 증감률 (%)
    - 해당 월 신규 고객 수

---

### 3. Mission 2: 고객 분석 및 세그멘테이션

- **시나리오**: 마케팅 팀에서 고객 등급별로 맞춤형 프로모션을 진행하기 위한 데이터 분석을 요청했습니다.

- **과제 2-1: VIP 고객 식별 뷰 (`vip_customers`)**
  - 다음 조건을 모두 만족하는 VIP 고객 목록을 조회하는 뷰를 생성하시오.
    - 총 결제 금액이 상위 10%에 해당하는 고객
    - 총 대여 횟수가 20회 이상인 고객

- **과제 2-2: 고객 세그멘테이션 프로시저 (`segment_customers`)**
  - 모든 고객을 총 결제액 기준으로 아래와 같이 4개 등급으로 분류하고, 등급별 통계(고객 수, 평균 결제액)를 출력하는 저장 프로시저를 작성하시오.
    - **VIP**: $150 이상
    - **Gold**: $100 - $149.99
    - **Silver**: $50 - $99.99
    - **Bronze**: $50 미만

---

### 4. Mission 3: 재고 및 인기 영화 분석

- **시나리오**: 영화 구매 담당자가 효율적인 재고 관리를 위해 인기 영화와 비인기 영화를 분석하고자 합니다.

- **과제 3-1: 영화별 인기도 분석 뷰 (`film_popularity`)**
  - 영화별로 아래 정보를 포함하는 뷰를 생성하시오.
    - 영화 제목, 대여 횟수, 총 매출, 현재 재고 수

- **과제 3-2: 카테고리별 성과 분석**
  - 각 영화 카테고리별 `총 대여 횟수`와 `총 매출`을 집계하여 가장 실적이 좋은 카테고리를 찾으시오.

---

### 5. Mission 4: 쿼리 성능 최적화

- **시나리오**: 서비스의 일부 쿼리가 느리게 동작하여 사용자의 불만이 접수되었습니다. 원인을 분석하고 성능을 개선해야 합니다.

- **과제 4-1: 느린 쿼리 분석 및 개선**
  - 여러 테이블을 `JOIN`하고 `GROUP BY`, `HAVING`을 사용하는 복잡한 쿼리의 실행 계획을 `EXPLAIN`으로 분석하시오.
  - `type`이 `ALL`로 표시되는 등 비효율적인 부분을 찾아내고, 적절한 인덱스를 추가하여 성능을 개선하시오.

- **과제 4-2: 쿼리 리팩토링**
  - `SELECT` 절에 상관 서브쿼리를 사용하여 성능이 저하되는 쿼리를 `JOIN`을 사용하도록 변경하여 성능을 개선하시오.
