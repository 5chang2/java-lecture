# 4.4. 쿼리 성능 최적화 핵심 요약

- **쿼리 성능 최적화**: SQL 쿼리가 더 빠르고 효율적으로 실행되도록 개선하는 과정. 느린 쿼리는 서비스 전체의 성능을 저하시키는 주된 원인.

---

### 1. `EXPLAIN` (실행 계획 확인)

- **설명**: SQL 쿼리가 데이터베이스 내부에서 어떻게 실행될 것인지에 대한 **계획**을 보여주는 명령어. 쿼리 튜닝의 필수 도구.
- **사용법**: `EXPLAIN SELECT ...;`

- **핵심 확인 항목**
  - **`type`**: 쿼리 실행 방식. **성능의 가장 중요한 지표.**
    - **ALL**: 테이블 전체를 스캔 (Full Table Scan). **최악의 경우**이며 반드시 개선해야 함.
    - **index**: 인덱스 전체를 스캔.
    - **range**: 인덱스를 사용하여 특정 범위 검색 (`BETWEEN`, `>`, `<`).
    - **ref**: 인덱스를 사용하여 동등(=) 비교 검색.
    - **const / system**: PRIMARY KEY나 UNIQUE KEY로 단 하나의 행을 찾는 경우. **가장 빠른 방식**.

  - **`key`**: 쿼리 실행에 실제로 사용된 인덱스의 이름. `NULL`이면 인덱스를 사용하지 못했다는 의미.

  - **`rows`**: 쿼리를 처리하기 위해 검사할 것으로 예상되는 행의 수. 이 값이 작을수록 좋음.

  - **`Extra`**: 추가적인 실행 정보.
    - `Using index`: **커버링 인덱스**. 테이블에 접근하지 않고 인덱스만으로 결과를 반환하는 최상의 상태.
    - `Using filesort`: 인덱스를 사용하지 못하고 별도의 정렬 작업을 수행. 성능 저하의 원인.
    - `Using temporary`: 쿼리 결과를 담기 위해 임시 테이블을 사용. 성능 저하의 원인.

---

### 2. 쿼리 최적화 기본 원칙

1.  **`SELECT *` 사용 피하기**
    - 꼭 필요한 컬럼만 명시적으로 조회.
    - 이유: 불필요한 데이터 전송 방지, 커버링 인덱스 활용 가능성 증가.

2.  **`WHERE` 절에 인덱스 컬럼 가공하지 않기**
    - 인덱스가 적용된 컬럼에 함수를 사용하거나 연산을 가하면 인덱스가 동작하지 않음.
    - `WHERE UPPER(name) = '...'` (X)
    - `WHERE name = '...'` (O)

3.  **`JOIN`의 연결(ON) 컬럼에 인덱스 생성하기**
    - `JOIN` 시 연결의 기준이 되는 컬럼들에는 인덱스가 필수적.

4.  **`ORDER BY` 절에 인덱스 활용하기**
    - 정렬에 사용되는 컬럼에 인덱스가 있으면 `filesort`를 피할 수 있어 성능이 향상됨.

5.  **`LIKE` 검색 시 앞부분에 와일드카드(`%`) 피하기**
    - `WHERE name LIKE '%검색어'` (X) → 인덱스 사용 불가.
    - `WHERE name LIKE '검색어%'` (O) → 인덱스 사용 가능.

6.  **`LIMIT` 적극적으로 사용하기**
    - 불필요하게 많은 데이터를 조회하지 않도록 결과 개수를 제한.

7.  **`EXISTS` 고려하기**
    - `IN` 절의 서브쿼리 결과가 매우 클 경우, `EXISTS`를 사용하는 것이 성능상 유리할 수 있음.
