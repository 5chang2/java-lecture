
## 🛡️ 데이터베이스 정규화 (Normalization)

**정규화**란 데이터의 중복을 최소화하고, **데이터 무결성(Data Integrity)**을 보장하기 위해 데이터베이스 구조를 재구성하는 과정입니다. 이를 통해 데이터 삽입, 수정, 삭제 시 발생할 수 있는 이상 현상(Anomaly)을 방지하고 데이터베이스의 일관성과 안정성을 높일 수 있습니다.

### **데이터 무결성 (Data Integrity)**

데이터베이스에 저장된 데이터의 **정확성**과 **일관성**을 보장하는 핵심 개념입니다.

-   🔑 **개체 무결성 (Entity Integrity)**
    -   모든 테이블은 각 행을 고유하게 식별할 수 있는 **기본 키(Primary Key)**를 가져야 하며, 이 기본 키는 `NULL` 값을 가질 수 없습니다.
    -   *예: `학생` 테이블의 `학번`은 비어있을 수 없으며 중복되지 않아야 합니다.*

-   🔗 **참조 무결성 (Referential Integrity)**
    -   **외래 키(Foreign Key)** 값은 반드시 참조하는 테이블의 기본 키 값 중 하나이거나 `NULL`이어야 합니다. 이를 통해 테이블 간의 관계가 유효하게 유지됩니다.
    -   *예: `주문` 테이블의 `고객ID`는 반드시 `고객` 테이블에 존재하는 `고객ID`여야 합니다.*

-   📋 **도메인 무결성 (Domain Integrity)**
    -   테이블의 각 열은 미리 정의된 데이터 타입, 형식, 범위 등(도메인)을 준수해야 합니다.
    -   *예: `나이` 열에는 양의 정수만 입력되어야 하며, `성별` 열에는 '남' 또는 '여'만 허용됩니다.*

---

## 💎 정규화 단계별 원칙

### **제1정규형 (1NF): 원자적 값**

> 테이블의 모든 열은 **원자값(Atomic Value)**, 즉 더 이상 분해할 수 없는 단일 값을 가져야 합니다.

-   **Before (1NF 위반)**: `자격증` 열에 여러 값이 포함되어 있습니다.

| 직원 ID | 이름 | 자격증 |
| :---: | :--: | :---------------: |
|  101  | 김철수 | 정보처리기사, SQLD |
|  102  | 이영희 |        DAP        |

-   **After (1NF 만족)**: 각 행이 하나의 정보만 갖도록 테이블을 분리합니다.

| 직원 ID | 이름 | 자격증 |
| :---: | :--: | :-------: |
|  101  | 김철수 | 정보처리기사 |
|  101  | 김철수 |   SQLD    |
|  102  | 이영희 |    DAP    |

---

### **제2정규형 (2NF): 완전 함수 종속**

> 제1정규형을 만족하고, **기본 키의 일부에만 종속되는 열이 없어야 합니다.** 모든 열은 기본 키 전체에 완전하게 종속되어야 합니다. (복합 키를 사용하는 테이블에 적용됩니다.)

-   **Before (2NF 위반)**: 기본 키는 `(주문 번호, 제품 번호)`입니다. 하지만 `제품명`은 기본 키의 일부인 `제품 번호`에만 종속됩니다.

| 주문 번호 | 제품 번호 | 제품명 | 수량 |
| :-----: | :-----: | :--: | :--: |
|  A001   |   P01   | 노트북 |  1   |
|  A001   |   P02   | 마우스 |  1   |
|  A002   |   P01   | 노트북 |  2   |

-   **After (2NF 만족)**: 부분 종속 관계를 제거하기 위해 테이블을 분리합니다.

**주문 내역**

| 주문 번호 | 제품 번호 | 수량 |
| :-----: | :-----: | :--: |
|  A001   |   P01   |  1   |
|  A001   |   P02   |  1   |
|  A002   |   P01   |  2   |

**제품 정보**

| 제품 번호 | 제품명 |
| :-----: | :--: |
|   P01   | 노트북 |
|   P02   | 마우스 |

---

### **제3정규형 (3NF): 이행적 종속 제거**

> 제2정규형을 만족하고, **기본 키가 아닌 열들 간에 종속 관계(이행적 종속)가 없어야 합니다.**

-   **Before (3NF 위반)**: `부서명`은 기본 키인 `직원 ID`가 아닌 `부서 코드`에 종속됩니다. (`직원 ID` → `부서 코드` → `부서명`)

| 직원 ID | 이름 | 부서 코드 | 부서명 |
| :---: | :--: | :-----: | :--: |
|  101  | 김철수 |   D01   | 인사팀 |
|  102  | 이영희 |   D02   | 개발팀 |
|  103  | 박민준 |   D01   | 인사팀 |

-   **After (3NF 만족)**: 이행적 종속 관계에 있는 `부서` 정보를 별도 테이블로 분리합니다.

**직원**

| 직원 ID | 이름 | 부서 코드 |
| :---: | :--: | :-----: |
|  101  | 김철수 |   D01   |
|  102  | 이영희 |   D02   |
|  103  | 박민준 |   D01   |

**부서**

| 부서 코드 | 부서명 |
| :-----: | :--: |
|   D01   | 인사팀 |
|   D02   | 개발팀 |

---

### **BCNF (Boyce-Codd 정규형): 모든 결정자를 후보 키로**

> 제3정규형을 만족하면서, 테이블의 **모든 결정자(Determinant)가 후보 키(Candidate Key)여야 한다는** 더 강화된 규칙입니다.

-   **Before (BCNF 위반)**: 후보 키는 `(학생, 과목)`입니다. 한 교수는 한 과목만 가르친다고 가정하면, `교수`가 `과목`을 결정하므로 `교수`는 결정자입니다. 하지만 `교수`는 후보 키가 아닙니다.

| 학생 | 과목 | 교수 |
| :--: | :--: | :--: |
| 김민준 | 물리 | 박교수 |
| 이서연 | 물리 | 박교수 |
| 박하준 | 화학 | 최교수 |
| 김민준 | 화학 | 최교수 |

-   **After (BCNF 만족)**: 결정자인 `교수`를 후보 키로 갖는 테이블로 분리합니다.

**수강생**

| 학생 | 교수 |
| :--: | :--: |
| 김민준 | 박교수 |
| 이서연 | 박교수 |
| 박하준 | 최교수 |
| 김민준 | 최교수 |

**교수 담당**

| 교수 | 과목 |
| :--: | :--: |
| 박교수 | 물리 |
| 최교수 | 화학 |

---

## ✍️ 데이터베이스 정규화 연습 문제

아래 정규화되지 않은 테이블을 제3정규형(3NF)까지 변환해 보세요.

### **문제: 정규화되지 않은 주문 관리 테이블**

| 주문번호 | 주문일자 | 고객ID | 고객명 | 고객등급 | 제품번호 및 수량 | 제품명 | 단가 |
| :---: | :--------: | :---: | :--: | :---: | :-----------------: | :----------: | :-----------------: |
| 1001 | 2023-10-01 | C001 | 김철수 | Gold | P01 (2개), P02 (1개) | 노트북, 마우스 | 1,500,000, 25,000 |
| 1002 | 2023-10-01 | C002 | 이영희 | Silver | P03 (5개) | 키보드 | 50,000 |
| 1003 | 2023-10-02 | C001 | 김철수 | Gold | P02 (3개) | 마우스 | 25,000 |

-   **종속성 관계**
    -   `고객ID` → `고객명`, `고객등급`
    -   `제품번호` → `제품명`, `단가`

---

### **풀이 및 답안**

#### **1단계: 제1정규형 (1NF)으로 변환 (원자성 확보)**

-   **목표**: 각 열이 단일 값을 갖도록 분해합니다.
-   **결과**: 기본 키는 `(주문번호, 제품번호)`가 됩니다.

| 주문번호 | 주문일자 | 고객ID | 고객명 | 고객등급 | 제품번호 | 수량 | 제품명 | 단가 |
| :---: | :--------: | :---: | :--: | :---: | :---: | :--: | :--: | :-------: |
| 1001 | 2023-10-01 | C001 | 김철수 | Gold | P01 | 2 | 노트북 | 1,500,000 |
| 1001 | 2023-10-01 | C001 | 김철수 | Gold | P02 | 1 | 마우스 | 25,000 |
| 1002 | 2023-10-01 | C002 | 이영희 | Silver | P03 | 5 | 키보드 | 50,000 |
| 1003 | 2023-10-02 | C001 | 김철수 | Gold | P02 | 3 | 마우스 | 25,000 |

#### **2단계: 제2정규형 (2NF)으로 변환 (부분 종속 제거)**

-   **목표**: 기본 키의 일부에만 종속된 열들을 별도의 테이블로 분리합니다.
    -   `주문일자`, `고객정보`는 `주문번호`에 종속됩니다.
    -   `제품정보`는 `제품번호`에 종속됩니다.
-   **결과**: `주문`, `제품`, `주문상세` 테이블로 분리됩니다.

#### **3단계: 제3정규형 (3NF)으로 변환 (이행적 종속 제거)**

-   **목표**: 기본 키가 아닌 일반 열 간의 종속 관계를 제거합니다.
-   **내용**: 2단계에서 만들어진 `주문` 테이블에서 `고객명`, `고객등급`이 `고객ID`에 종속되므로 (`주문번호` → `고객ID` → `고객정보`), `고객` 테이블을 추가로 분리합니다.

### **최종 결과: 3NF 정규화 완료된 테이블**

**1. 고객 (Customers)**

| 고객ID (PK) | 고객명 | 고객등급 |
| :---: | :--: | :---: |
| C001 | 김철수 | Gold |
| C002 | 이영희 | Silver |

**2. 제품 (Products)**

| 제품번호 (PK) | 제품명 | 단가 |
| :---: | :--: | :-------: |
| P01 | 노트북 | 1,500,000 |
| P02 | 마우스 | 25,000 |
| P03 | 키보드 | 50,000 |

**3. 주문 (Orders)**

| 주문번호 (PK) | 주문일자 | 고객ID (FK) |
| :---: | :--------: | :---: |
| 1001 | 2023-10-01 | C001 |
| 1002 | 2023-10-01 | C002 |
| 1003 | 2023-10-02 | C001 |

**4. 주문상세 (Order\_Details)**

| 주문번호 (FK) | 제품번호 (FK) | 수량 |
| :---: | :---: | :--: |
| 1001 | P01 | 2 |
| 1001 | P02 | 1 |
| 1002 | P03 | 5 |
| 1003 | P02 | 3 |
*복합 기본 키: `(주문번호, 제품번호)`*