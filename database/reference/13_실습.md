### ## 🌏 world 데이터베이스 JOIN 연습 문제

> **💡 실습 준비**
>
> 모든 문제를 시작하기 전, `world` 데이터베이스를 사용하겠다고 MySQL에 알려주세요.
>
```sql
USE world;
```

---

### ### **Level 1: 기본 INNER JOIN**

1.  `city` 테이블과 `country` 테이블을 조인하여, 각 도시가 어느 국가에 속해 있는지 국가명과 함께 조회하세요. (결과는 상위 10개만 출력)
```sql
SELECT
  ci.Name AS '도시명',
  co.Name AS '국가명'
FROM
  city ci
INNER JOIN
  country co ON ci.CountryCode = co.Code
LIMIT 10;
```

2.  `country` 테이블과 `countrylanguage` 테이블을 조인하여, 'English'를 사용하는 국가들의 이름(Name)과 해당 언어(Language)를 조회하세요.
```sql
SELECT
  co.Name,
  cl.Language
FROM
  country co
INNER JOIN
  countrylanguage cl ON co.Code = cl.CountryCode
WHERE
  cl.Language = 'English';
```

3.  `city` 테이블과 `country` 테이블을 조인하여, 'Europe' 대륙에 속한 도시들의 이름과 해당 도시의 인구수를 조회하세요.
```sql
SELECT
  ci.Name,
  ci.Population
FROM
  city ci
INNER JOIN
  country co ON ci.CountryCode = co.Code
WHERE
  co.Continent = 'Europe';
```

4.  `country` 테이블과 `countrylanguage` 테이블을 조인하여, 공식 언어(IsOfficial = 'T')가 아닌 언어를 사용하는 국가들의 이름과 언어, 공식 여부를 조회하세요. (결과는 상위 10개만 출력)
```sql
SELECT
  co.Name,
  cl.Language,
  cl.IsOfficial
FROM
  country co
INNER JOIN
  countrylanguage cl ON co.Code = cl.CountryCode
WHERE
  cl.IsOfficial = 'F'
LIMIT 10;
```

5.  `country` 테이블에서 수도(Capital)가 있는 국가들의 이름과, `city` 테이블을 조인하여 해당 수도의 이름을 조회하세요.
```sql
SELECT
  co.Name AS '국가명',
  ci.Name AS '수도명'
FROM
  country co
INNER JOIN
  city ci ON co.Capital = ci.ID;
```

---

### ### **Level 2: LEFT JOIN 및 여러 테이블 JOIN**

1.  `country` 테이블을 기준으로 `city` 테이블을 `LEFT JOIN`하여, 모든 국가의 이름과 해당 국가에 속한 도시의 수를 계산하여 조회하세요. 도시가 없는 국가도 결과에 포함되어야 합니다.
```sql
SELECT
  co.Name,
  COUNT(ci.ID) AS '도시_수'
FROM
  country co
LEFT JOIN
  city ci ON co.Code = ci.CountryCode
GROUP BY
  co.Name;
```

2.  `country` 테이블, `city` 테이블, `countrylanguage` 테이블을 모두 조인하여, 'South America' 대륙에 속한 국가들의 공식 언어와 수도의 인구수를 조회하세요.
```sql
SELECT
  co.Name AS '국가명',
  cl.Language AS '공식언어',
  ci.Population AS '수도_인구'
FROM
  country co
INNER JOIN
  city ci ON co.Capital = ci.ID
INNER JOIN
  countrylanguage cl ON co.Code = cl.CountryCode
WHERE
  co.Continent = 'South America' AND cl.IsOfficial = 'T';
```

3.  `country` 테이블을 기준으로 `countrylanguage` 테이블을 `LEFT JOIN`하여, 공식 언어가 없는(IsOfficial='F'만 있거나 아예 언어 정보가 없는) 국가의 이름을 조회하세요.
```sql
SELECT
  co.Name
FROM
  country co
LEFT JOIN
  countrylanguage cl ON co.Code = cl.CountryCode AND cl.IsOfficial = 'T'
WHERE
  cl.Language IS NULL;
```

4.  'United States'의 모든 도시 이름과, 각 도시가 속한 주(District)의 이름을 함께 조회하세요.
```sql
SELECT
  ci.Name AS '도시명',
  ci.District AS '주'
FROM
  city ci
INNER JOIN
  country co ON ci.CountryCode = co.Code
WHERE
  co.Name = 'United States';
```

5.  각 대륙(Continent)별로 가장 인구가 많은 도시(city)의 이름과 인구수, 그리고 해당 도시가 속한 국가의 이름을 조회하세요. (서브쿼리 또는 윈도우 함수 사용 가능, 여기서는 서브쿼리 활용)
```sql
SELECT
  c.Continent,
  c.Name AS CountryName, -- 이 부분을 수정했습니다 (co.Name -> c.Name)
  ci.Name AS CityName,
  ci.Population
FROM
  country c
INNER JOIN
  city ci ON c.Code = ci.CountryCode
INNER JOIN
  (SELECT
     co.Continent,
     MAX(ci.Population) AS MaxPop
   FROM
     country co
   INNER JOIN
     city ci ON co.Code = ci.CountryCode
   GROUP BY
     co.Continent) AS max_pop_per_continent ON c.Continent = max_pop_per_continent.Continent AND ci.Population = max_pop_per_continent.MaxPop;
```

---

### ### **Level 3: SELF JOIN 및 복합 JOIN 응용**

1.  `country` 테이블을 `SELF JOIN`하여, 같은 대륙(Continent)에 속하면서 인구는 5천만명 이상 차이 나는 국가 쌍의 목록을 조회하세요.
```sql
SELECT
  c1.Name AS Country1,
  c2.Name AS Country2,
  c1.Continent
FROM
  country c1
INNER JOIN
  country c2 ON c1.Continent = c2.Continent AND c1.Code < c2.Code
WHERE
  ABS(c1.Population - c2.Population) >= 50000000;
```

2.  인구가 100만 이상인 도시들 중에서, 같은 국가에 속하면서 인구가 비슷한(차이가 1% 미만) 도시 쌍을 찾아 조회하세요.
```sql
SELECT
  c1.Name AS City1,
  c1.Population AS Pop1,
  c2.Name AS City2,
  c2.Population AS Pop2,
  c1.CountryCode
FROM
  city c1
INNER JOIN
  city c2 ON c1.CountryCode = c2.CountryCode AND c1.ID < c2.ID
WHERE
  c1.Population >= 1000000
  AND ABS(c1.Population - c2.Population) / c1.Population < 0.01;
```

3.  `countrylanguage` 테이블을 사용하여, 두 개 이상의 국가에서 공식 언어('T')로 지정된 언어들의 목록과, 해당 언어를 공식 언어로 사용하는 국가의 수를 조회하세요.
```sql
SELECT
  Language,
  COUNT(CountryCode) AS NumberOfCountries
FROM
  countrylanguage
WHERE
  IsOfficial = 'T'
GROUP BY
  Language
HAVING
  NumberOfCountries >= 2
ORDER BY
  NumberOfCountries DESC;
```

4.  대륙(Continent)별로 평균 GNP가 가장 높은 국가와 가장 낮은 국가의 이름, 그리고 해당 대륙의 평균 GNP를 함께 조회하세요. (복잡한 쿼리, 윈도우 함수 사용 추천)
```sql
WITH RankedCountries AS (
  SELECT
	Name,
	Continent,
	GNP,
	ROW_NUMBER() OVER(PARTITION BY Continent ORDER BY GNP DESC) as rn_desc,
	ROW_NUMBER() OVER(PARTITION BY Continent ORDER BY GNP ASC) as rn_asc,
	AVG(GNP) OVER(PARTITION BY Continent) as avg_gnp
  FROM country
  WHERE GNP > 0
)
SELECT
  Continent,
  MAX(CASE WHEN rn_desc = 1 THEN Name END) AS HighestGNPCountry,
  MAX(CASE WHEN rn_asc = 1 THEN Name END) AS LowestGNPCountry,
  AVG(avg_gnp) AS ContinentAvgGNP
FROM RankedCountries
WHERE rn_desc = 1 OR rn_asc = 1
GROUP BY Continent;
```

5.  `country` 테이블과 `city` 테이블을 조인하여, 국가의 인구수 대비 수도의 인구수 비율(수도 집중도)을 계산하고, 이 비율이 가장 높은 상위 5개 국가를 조회하세요.
```sql
SELECT
  co.Name AS CountryName,
  ci.Name AS CapitalName,
  (ci.Population / co.Population) * 100 AS CapitalConcentrationRatio
FROM
  country co
INNER JOIN
  city ci ON co.Capital = ci.ID
WHERE
  co.Population > 0
ORDER BY
  CapitalConcentrationRatio DESC
LIMIT 5;
```
