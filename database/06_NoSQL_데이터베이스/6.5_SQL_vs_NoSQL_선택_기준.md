# 6.5. SQL vs NoSQL 선택 기준

## 학습 목표
- SQL과 NoSQL의 선택 기준을 이해한다
- 프로젝트 요구사항에 맞는 데이터베이스를 선택할 수 있다
- Polyglot Persistence 개념을 학습한다

---

## 1. 선택 기준 결정 트리

```
프로젝트 시작
    │
    ├─ 데이터 구조가 명확하고 관계가 복잡한가?
    │   YES → SQL 고려
    │   NO → 아래 계속
    │
    ├─ 대량의 읽기/쓰기가 필요한가?
    │   YES → NoSQL 고려
    │   NO → 아래 계속
    │
    ├─ ACID 트랜잭션이 필수인가?
    │   YES → SQL
    │   NO → 아래 계속
    │
    ├─ 수평 확장이 필요한가?
    │   YES → NoSQL
    │   NO → SQL 가능
    │
    └─ 스키마가 자주 변경되는가?
        YES → NoSQL
        NO → SQL
```

---

## 2. SQL을 선택해야 하는 경우

### 2.1. 명확한 요구사항

✅ **다음과 같은 경우 SQL 선택:**

1. **복잡한 관계**
   - 다중 테이블 JOIN이 빈번
   - 데이터 간 관계가 명확

2. **강력한 트랜잭션 필요**
   - 금융, 결제, 회계 시스템
   - 데이터 일관성이 중요

3. **복잡한 쿼리와 집계**
   - BI(비즈니스 인텔리전스) 리포트
   - 복잡한 분석 쿼리

4. **잘 정의된 스키마**
   - 스키마가 안정적
   - 데이터 구조가 변경되지 않음

### 2.2. SQL 사용 사례

- 은행 시스템
- ERP, CRM 시스템
- 전자상거래 주문/결제
- 재고 관리
- 회계 시스템

**예시: 은행 계좌 이체**
```sql
START TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE id = 1;
UPDATE accounts SET balance = balance + 100 WHERE id = 2;
COMMIT;
```

---

## 3. NoSQL을 선택해야 하는 경우

### 3.1. 명확한 요구사항

✅ **다음과 같은 경우 NoSQL 선택:**

1. **대량 데이터**
   - 빅데이터 처리
   - 로그, 센서 데이터

2. **빠른 읽기/쓰기**
   - 실시간 처리
   - 높은 처리량 필요

3. **유연한 스키마**
   - 스키마가 자주 변경
   - 다양한 형태의 데이터

4. **수평 확장**
   - 서버 추가로 확장
   - 분산 시스템

### 3.2. NoSQL 사용 사례

- 소셜 미디어 (Facebook, Twitter)
- 실시간 분석
- IoT 센서 데이터
- 세션 저장 (Redis)
- 콘텐츠 관리 시스템
- 로그 수집

**예시: 소셜 미디어 포스트**
```javascript
db.posts.insertOne({
    author: "Alice",
    content: "Hello MongoDB!",
    tags: ["tech", "database"],
    likes: 0,
    comments: [],
    timestamp: new Date()
})
```

---

## 4. 비교표

| 기준 | SQL | NoSQL |
|------|-----|-------|
| **데이터 구조** | 정형 데이터 | 비정형/반정형 데이터 |
| **스키마** | 고정 | 유연 |
| **확장** | 수직 (Scale-up) | 수평 (Scale-out) |
| **트랜잭션** | ACID 완벽 지원 | 제한적 |
| **복잡한 쿼리** | 강력 | 제한적 |
| **성능** | 복잡한 JOIN 시 느릴 수 있음 | 단순 읽기/쓰기 빠름 |
| **일관성** | 강한 일관성 | 최종 일관성 |
| **학습 곡선** | 표준화된 SQL | DB마다 다름 |
| **비용** | 고성능 서버 비용 높음 | 저렴한 서버 여러 대 |

---

## 5. Polyglot Persistence (다중 저장소)

### 5.1. 개념

**하나의 애플리케이션에서 여러 종류의 데이터베이스를 함께 사용**

```
┌─────────────────┐
│  애플리케이션   │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───┴──┐  ┌──┴───┐
│ SQL  │  │NoSQL │
└──────┘  └──────┘
```

### 5.2. 실제 사례

**전자상거래 플랫폼:**
```
├─ MySQL
│   └─ 주문, 결제 (트랜잭션 필요)
├─ MongoDB
│   └─ 상품 카탈로그 (유연한 스키마)
├─ Redis
│   └─ 세션, 장바구니 (빠른 접근)
└─ Elasticsearch
    └─ 상품 검색 (전문 검색)
```

**소셜 미디어:**
```
├─ PostgreSQL
│   └─ 사용자 프로필 (관계형)
├─ MongoDB
│   └─ 포스트, 댓글 (문서형)
├─ Redis
│   └─ 실시간 알림 (캐싱)
└─ Neo4j
    └─ 친구 관계 (그래프)
```

---

## 6. 실전 의사결정 예시

### 예시 1: 블로그 플랫폼

**요구사항:**
- 포스트 작성/조회
- 댓글 기능
- 태그 검색
- 사용자 인증

**선택:** MongoDB
- 포스트 구조가 유연 (본문, 이미지, 동영상 등)
- 댓글을 포스트에 내장 가능
- 복잡한 트랜잭션 불필요

### 예시 2: 온라인 뱅킹

**요구사항:**
- 계좌 이체
- 거래 내역
- 잔액 조회
- 데이터 무결성 중요

**선택:** SQL (MySQL, PostgreSQL)
- ACID 트랜잭션 필수
- 복잡한 관계 (계좌, 거래, 사용자)
- 데이터 일관성 최우선

### 예시 3: 실시간 채팅

**요구사항:**
- 실시간 메시지 전송
- 메시지 이력
- 사용자 상태 (온라인/오프라인)

**선택:** Redis + MongoDB
- Redis: 실시간 메시지, 사용자 상태 (빠름)
- MongoDB: 메시지 이력 저장 (영구)

---

## 7. 마이그레이션 고려사항

### 7.1. SQL → NoSQL

**언제:**
- 확장성 한계
- 스키마 변경이 잦음
- 읽기 성능 개선 필요

**주의사항:**
- 트랜잭션 처리 방법 재설계
- 데이터 모델 재구성
- 애플리케이션 로직 수정

### 7.2. NoSQL → SQL

**언제:**
- 복잡한 쿼리 필요
- 강력한 일관성 필요
- 데이터 관계 증가

---

## 강사 가이드

### 수업 진행 팁

1. **실제 사례 중심** (30분)
   - 유명 서비스들이 사용하는 DB 소개
   - 왜 그 선택을 했는지 분석

2. **팀 토론** (20분)
   - 가상의 프로젝트 주고 DB 선택하기
   - 장단점 토론

3. **Polyglot Persistence 강조** (15분)
   - "하나만 선택"이 아닌 "함께 사용"
   - 각 DB의 장점 활용

### 자주 하는 질문

**Q: NoSQL이 SQL을 대체하나요?**
> A: 아니요. 각각의 용도가 다릅니다. 적절한 상황에 맞게 선택하거나 함께 사용합니다.

**Q: 작은 프로젝트에서는 어떤 것을 선택해야 하나요?**
> A: 익숙한 것을 선택하세요. 작은 프로젝트에서는 큰 차이가 없습니다.

**Q: 둘 다 배워야 하나요?**
> A: 네, 현대 개발자는 SQL과 NoSQL 모두 다룰 줄 알아야 합니다.

---

## 요약

### 선택 기준 한눈에

**SQL을 선택하세요:**
- ✅ 복잡한 관계
- ✅ ACID 트랜잭션 필수
- ✅ 복잡한 쿼리/집계
- ✅ 안정적인 스키마

**NoSQL을 선택하세요:**
- ✅ 대량 데이터
- ✅ 빠른 읽기/쓰기
- ✅ 유연한 스키마
- ✅ 수평 확장

**함께 사용하세요:** Polyglot Persistence

### 다음 단계
다음 시간에는 **MongoDB 실습 프로젝트**를 진행합니다.
