# 6.2. MongoDB 설치 및 기본 명령어

## 학습 목표
- MongoDB를 설치하고 실행하는 방법을 익힌다
- mongo shell (mongosh)의 기본 사용법을 학습한다
- 데이터베이스와 컬렉션의 개념을 이해한다
- 기본적인 MongoDB 명령어를 실행할 수 있다

---

## 1. MongoDB 소개

**MongoDB**는 가장 인기 있는 **문서 지향(Document-Oriented) NoSQL 데이터베이스**입니다.

### 1.1. 주요 특징

- **JSON 형태의 문서** (실제로는 BSON - Binary JSON)
- **유연한 스키마** (Schema-less)
- **강력한 쿼리 기능** (집계, 인덱싱 지원)
- **수평 확장** (Sharding 지원)
- **고가용성** (Replica Set 지원)

### 1.2. MongoDB 용어

| SQL 용어 | MongoDB 용어 | 설명 |
|---------|-------------|------|
| Database | Database | 데이터베이스 |
| Table | Collection | 테이블 → 컬렉션 |
| Row | Document | 행 → 문서 |
| Column | Field | 열 → 필드 |
| Index | Index | 인덱스 |
| JOIN | Embed/Reference | 조인 → 내장/참조 |

```
SQL:
Database → Table → Row → Column

MongoDB:
Database → Collection → Document → Field
```

---

## 2. MongoDB 설치

### 2.1. Windows 설치

**방법 1: 공식 사이트에서 다운로드**

1. https://www.mongodb.com/try/download/community 접속
2. 본인의 OS에 맞는 버전 다운로드 (Windows x64)
3. MSI 파일 실행
4. "Complete" 설치 선택
5. "Install MongoDB as a Service" 체크
6. 설치 완료

**설치 확인:**
```bash
# 명령 프롬프트 또는 PowerShell
mongod --version

# MongoDB Shell 버전 확인
mongosh --version
```

**방법 2: Chocolatey 사용 (패키지 관리자)**
```bash
choco install mongodb
choco install mongodb-shell
```

### 2.2. macOS 설치

**Homebrew 사용:**
```bash
# Homebrew Tap 추가
brew tap mongodb/brew

# MongoDB 설치
brew install mongodb-community

# 서비스 시작
brew services start mongodb-community

# 설치 확인
mongod --version
mongosh --version
```

### 2.3. Linux (Ubuntu) 설치

```bash
# 패키지 저장소 추가
wget -qO - https://www.mongodb.org/static/pgp/server-7.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list

# 패키지 목록 업데이트
sudo apt-get update

# MongoDB 설치
sudo apt-get install -y mongodb-org

# 서비스 시작
sudo systemctl start mongod
sudo systemctl enable mongod

# 상태 확인
sudo systemctl status mongod
```

---

## 3. MongoDB 실행

### 3.1. MongoDB 서버 시작

**Windows:**
```bash
# 서비스로 자동 시작 (설치 시 설정했다면)
# 아니면 수동 시작:
mongod

# 또는
net start MongoDB
```

**macOS/Linux:**
```bash
# 서비스 시작
brew services start mongodb-community  # macOS
sudo systemctl start mongod            # Linux

# 또는 직접 실행
mongod
```

**기본 포트:** 27017

### 3.2. MongoDB Shell 접속

```bash
# MongoDB Shell (mongosh) 실행
mongosh

# 특정 호스트 접속
mongosh "mongodb://localhost:27017"

# 인증이 필요한 경우
mongosh -u username -p password --authenticationDatabase admin
```

**성공 시 출력:**
```
Current Mongosh Log ID: 65a1b2c3d4e5f6...
Connecting to: mongodb://127.0.0.1:27017/
Using MongoDB: 7.0.0
Using Mongosh: 2.0.0

test>
```

---

## 4. MongoDB Shell 기본 명령어

### 4.1. 도움말

```javascript
// 도움말 보기
help

// 데이터베이스 명령어 도움말
db.help()

// 컬렉션 명령어 도움말
db.collection.help()
```

### 4.2. 데이터베이스 작업

**데이터베이스 목록 확인:**
```javascript
show dbs
// 또는
show databases
```

**현재 데이터베이스 확인:**
```javascript
db
```

**데이터베이스 선택/생성:**
```javascript
// 데이터베이스 전환 (없으면 자동 생성)
use mydb

// 현재 DB 확인
db  // mydb
```

**참고:** MongoDB는 **데이터를 실제로 삽입할 때** 데이터베이스가 생성됩니다.

```javascript
use testdb
show dbs  // testdb가 아직 안 보임

db.users.insertOne({ name: "Alice" })  // 데이터 삽입
show dbs  // 이제 testdb가 보임!
```

**데이터베이스 삭제:**
```javascript
use testdb
db.dropDatabase()
```

### 4.3. 컬렉션 작업

**컬렉션 목록 확인:**
```javascript
show collections
// 또는
show tables
```

**컬렉션 생성:**
```javascript
// 명시적 생성
db.createCollection("users")

// 또는 데이터 삽입 시 자동 생성
db.products.insertOne({ name: "Laptop" })  // products 컬렉션 자동 생성
```

**컬렉션 삭제:**
```javascript
db.users.drop()
```

---

## 5. 기본 CRUD 명령어 소개

### 5.1. Create (생성)

```javascript
// 단일 문서 삽입
db.users.insertOne({
    name: "Alice",
    age: 25,
    email: "alice@example.com"
})

// 여러 문서 삽입
db.users.insertMany([
    { name: "Bob", age: 30, email: "bob@example.com" },
    { name: "Charlie", age: 35, email: "charlie@example.com" }
])
```

### 5.2. Read (조회)

```javascript
// 모든 문서 조회
db.users.find()

// 보기 좋게 출력
db.users.find().pretty()

// 특정 조건으로 조회
db.users.find({ name: "Alice" })

// 단일 문서 조회
db.users.findOne({ name: "Bob" })

// 문서 개수 확인
db.users.countDocuments()
```

### 5.3. Update (수정)

```javascript
// 단일 문서 수정
db.users.updateOne(
    { name: "Alice" },           // 조건
    { $set: { age: 26 } }        // 수정 내용
)

// 여러 문서 수정
db.users.updateMany(
    { age: { $lt: 30 } },        // 30세 미만
    { $set: { status: "young" } }
)
```

### 5.4. Delete (삭제)

```javascript
// 단일 문서 삭제
db.users.deleteOne({ name: "Charlie" })

// 여러 문서 삭제
db.users.deleteMany({ age: { $gt: 50 } })  // 50세 초과 모두 삭제

// 모든 문서 삭제 (컬렉션은 유지)
db.users.deleteMany({})
```

---

## 6. MongoDB 문서 구조

### 6.1. 문서 (Document)

MongoDB의 기본 데이터 단위는 **문서(Document)**입니다.

```javascript
{
    "_id": ObjectId("507f1f77bcf86cd799439011"),  // 자동 생성되는 고유 ID
    "name": "Alice",
    "age": 25,
    "email": "alice@example.com",
    "hobbies": ["reading", "coding"],            // 배열
    "address": {                                  // 중첩 객체
        "city": "Seoul",
        "zipcode": "12345"
    }
}
```

**특징:**
- JSON 형태 (실제로는 BSON)
- `_id` 필드가 자동으로 생성 (Primary Key 역할)
- 중첩 구조 가능 (배열, 객체)

### 6.2. ObjectId

```javascript
// ObjectId는 12바이트의 고유 식별자
ObjectId("507f1f77bcf86cd799439011")

// 구성:
// - 4 bytes: 타임스탬프
// - 5 bytes: 랜덤 값
// - 3 bytes: 카운터

// ObjectId에서 생성 시간 추출
ObjectId("507f1f77bcf86cd799439011").getTimestamp()
```

**자동 생성:**
```javascript
// _id를 지정하지 않으면 자동 생성
db.users.insertOne({ name: "Alice" })
// { "_id": ObjectId("..."), "name": "Alice" }

// _id를 직접 지정 가능
db.users.insertOne({ _id: 1, name: "Bob" })
// { "_id": 1, "name": "Bob" }
```

---

## 7. SQL vs MongoDB 명령어 비교

| SQL | MongoDB |
|-----|---------|
| `CREATE DATABASE mydb` | `use mydb` |
| `SHOW DATABASES` | `show dbs` |
| `USE mydb` | `use mydb` |
| `DROP DATABASE mydb` | `db.dropDatabase()` |
| `CREATE TABLE users (...)` | `db.createCollection("users")` |
| `SHOW TABLES` | `show collections` |
| `DROP TABLE users` | `db.users.drop()` |
| `INSERT INTO users VALUES (...)` | `db.users.insertOne({...})` |
| `SELECT * FROM users` | `db.users.find()` |
| `SELECT * FROM users WHERE age = 25` | `db.users.find({ age: 25 })` |
| `UPDATE users SET age = 26 WHERE name = 'Alice'` | `db.users.updateOne({ name: "Alice" }, { $set: { age: 26 } })` |
| `DELETE FROM users WHERE age > 50` | `db.users.deleteMany({ age: { $gt: 50 } })` |
| `SELECT COUNT(*) FROM users` | `db.users.countDocuments()` |

---

## 8. 실습: 첫 MongoDB 데이터베이스 만들기

### 실습 1: 데이터베이스 및 컬렉션 생성

```javascript
// 1. 데이터베이스 생성
use school

// 2. students 컬렉션에 데이터 삽입
db.students.insertOne({
    name: "김철수",
    age: 20,
    major: "컴퓨터공학",
    gpa: 3.8
})

// 3. 여러 학생 추가
db.students.insertMany([
    { name: "이영희", age: 21, major: "전자공학", gpa: 3.9 },
    { name: "박민수", age: 19, major: "컴퓨터공학", gpa: 3.5 },
    { name: "정수진", age: 22, major: "경영학", gpa: 4.0 }
])

// 4. 모든 학생 조회
db.students.find()

// 5. 컴퓨터공학과 학생만 조회
db.students.find({ major: "컴퓨터공학" })
```

### 실습 2: 데이터 수정 및 삭제

```javascript
// 1. 김철수의 학점 수정
db.students.updateOne(
    { name: "김철수" },
    { $set: { gpa: 4.0 } }
)

// 2. 모든 컴퓨터공학과 학생의 전공 수정
db.students.updateMany(
    { major: "컴퓨터공학" },
    { $set: { major: "소프트웨어공학" } }
)

// 3. GPA 3.5 미만 학생 삭제
db.students.deleteMany({ gpa: { $lt: 3.5 } })

// 4. 결과 확인
db.students.find()
```

---

## 9. MongoDB Compass (GUI 도구)

### 9.1. MongoDB Compass 소개

**MongoDB Compass**는 MongoDB의 공식 GUI 도구입니다.

**주요 기능:**
- 시각적으로 데이터 탐색
- 쿼리 작성 및 실행
- 인덱스 관리
- 성능 모니터링

### 9.2. 설치 및 사용

**설치:**
- https://www.mongodb.com/try/download/compass 에서 다운로드
- 설치 후 실행

**연결:**
```
MongoDB URI: mongodb://localhost:27017
```

**장점:**
- 초보자에게 친화적
- 데이터 시각화
- 쿼리 빌더

**단점:**
- 명령어 학습에는 shell이 더 효과적
- 프로덕션 환경에서는 shell 사용 필수

---

## 강사 가이드

### 수업 진행 팁

1. **설치부터 시작** (20분)
   - 학생들과 함께 설치 진행
   - 설치 중 발생하는 문제 즉시 해결
   - mongosh 실행까지 모두 확인

2. **Shell 익숙해지기** (20분)
   - `use`, `show dbs`, `show collections` 반복
   - Tab 자동완성 소개
   - 화살표 키로 이전 명령어 불러오기

3. **SQL과 비교하며 설명** (20분)
   - SQL 명령어와 나란히 보여주기
   - "SQL에서는 이렇게, MongoDB에서는 이렇게"
   - 용어 대응 강조 (Table → Collection, Row → Document)

4. **실습 중심** (30분)
   - 직접 데이터베이스 만들기
   - 컬렉션에 데이터 삽입
   - 조회, 수정, 삭제 실습
   - "일단 해보기"

5. **Compass 소개 (선택)** (10분)
   - GUI 도구 존재 알리기
   - 하지만 shell 학습이 우선임을 강조

### 자주 하는 질문

**Q1: MongoDB 서버가 시작되지 않아요.**
> A: 포트 충돌 확인 (27017), 방화벽 확인, 또는 `mongod --dbpath` 로 데이터 디렉토리 지정

**Q2: use로 DB를 만들었는데 show dbs에 안 나와요.**
> A: 데이터를 실제로 삽입해야 데이터베이스가 생성됩니다. `db.test.insertOne({test:1})` 실행 후 확인하세요.

**Q3: SQL처럼 스키마를 정의하지 않나요?**
> A: MongoDB는 스키마가 유연합니다. 하지만 실무에서는 Mongoose 같은 ODM을 사용하여 스키마를 정의합니다.

**Q4: _id를 직접 지정할 수 있나요?**
> A: 네, 가능합니다. `insertOne({ _id: 1, name: "Alice" })` 처럼 직접 지정할 수 있습니다.

**Q5: JSON과 BSON의 차이는?**
> A: BSON은 Binary JSON으로, 더 많은 데이터 타입(Date, ObjectId 등)을 지원하고 성능이 더 좋습니다.

### 실습 중 흔한 실수

1. **mongod vs mongosh 혼동**
```bash
mongod   # 서버 (데몬)
mongosh  # 클라이언트 (쉘)
```

2. **세미콜론 잊기**
```javascript
// MongoDB에서는 세미콜론 선택사항
db.users.find()  // OK
db.users.find(); // OK
```

3. **따옴표 사용**
```javascript
// 잘못된 예
db.users.find({ name: Alice })  // 에러!

// 올바른 예
db.users.find({ name: "Alice" })
```

---

## 요약

### 핵심 개념

**MongoDB 용어**
- Database → Database
- Table → Collection
- Row → Document
- Column → Field

**기본 명령어**
```javascript
// 데이터베이스
use mydb
show dbs
db.dropDatabase()

// 컬렉션
show collections
db.createCollection("users")
db.users.drop()

// CRUD
db.users.insertOne({...})
db.users.find()
db.users.updateOne({...}, {$set: {...}})
db.users.deleteOne({...})
```

**ObjectId**
- 자동 생성되는 고유 식별자
- `_id` 필드

### 다음 단계

다음 시간에는 **MongoDB CRUD 작업**을 자세히 학습합니다:
- insertOne, insertMany 상세
- find의 다양한 옵션
- update 연산자들 ($set, $inc, $push 등)
- delete 옵션들

---

**연습 권장사항:**
- mongosh로 여러 데이터베이스 만들어보기
- SQL 테이블을 MongoDB 컬렉션으로 변환해보기
- 기본 명령어들을 외울 때까지 반복
- MongoDB Compass로 데이터 시각화해보기
