# 6.6. 실습: MongoDB 실습 프로젝트

## 학습 목표
- MongoDB를 사용하여 완전한 애플리케이션 데이터 모델을 설계한다
- CRUD 작업, 집계, 인덱스를 종합적으로 활용한다
- 실무 시나리오를 MongoDB로 구현한다

---

## 프로젝트: 블로그 플랫폼

### 데이터 모델 설계

```javascript
// users 컬렉션
{
    _id: ObjectId("..."),
    username: "alice",
    email: "alice@example.com",
    password: "hashed_password",
    profile: {
        name: "Alice Kim",
        bio: "Developer",
        avatar: "url"
    },
    createdAt: new Date(),
    followers: []
}

// posts 컬렉션
{
    _id: ObjectId("..."),
    author: "alice",
    title: "MongoDB 시작하기",
    content: "MongoDB는...",
    tags: ["database", "nosql"],
    views: 0,
    likes: [],
    comments: [
        {
            author: "bob",
            text: "좋은 글입니다!",
            date: new Date()
        }
    ],
    createdAt: new Date(),
    published: true
}
```

---

## Mission 1: 사용자 관리 (⭐⭐)

### 1-1. 사용자 등록

```javascript
db.users.insertOne({
    username: "alice",
    email: "alice@example.com",
    password: "hashed_pass",
    profile: {
        name: "Alice Kim",
        bio: "Full-stack Developer"
    },
    createdAt: new Date(),
    followers: []
})

// 이메일 고유 인덱스
db.users.createIndex({ email: 1 }, { unique: true })
```

### 1-2. 사용자 팔로우

```javascript
// Alice가 Bob을 팔로우
db.users.updateOne(
    { username: "alice" },
    { $addToSet: { followers: "bob" } }
)
```

---

## Mission 2: 포스트 작성 및 관리 (⭐⭐⭐)

### 2-1. 포스트 작성

```javascript
db.posts.insertOne({
    author: "alice",
    title: "MongoDB 완벽 가이드",
    content: "이 글에서는...",
    tags: ["mongodb", "database", "tutorial"],
    views: 0,
    likes: [],
    comments: [],
    createdAt: new Date(),
    published: true
})

// 인덱스 생성
db.posts.createIndex({ author: 1 })
db.posts.createIndex({ tags: 1 })
db.posts.createIndex({ createdAt: -1 })
```

### 2-2. 포스트 조회

```javascript
// 최신 포스트 10개
db.posts.find({ published: true })
    .sort({ createdAt: -1 })
    .limit(10)

// 특정 태그 포스트
db.posts.find({ tags: "mongodb" })
    .sort({ views: -1 })

// 특정 저자의 포스트
db.posts.find({ author: "alice" })
```

### 2-3. 조회수 증가

```javascript
db.posts.updateOne(
    { _id: ObjectId("...") },
    { $inc: { views: 1 } }
)
```

---

## Mission 3: 댓글 시스템 (⭐⭐⭐)

### 3-1. 댓글 추가

```javascript
db.posts.updateOne(
    { _id: ObjectId("...") },
    {
        $push: {
            comments: {
                _id: ObjectId(),
                author: "bob",
                text: "훌륭한 글이네요!",
                date: new Date()
            }
        }
    }
)
```

### 3-2. 댓글 삭제

```javascript
db.posts.updateOne(
    { _id: ObjectId("...") },
    {
        $pull: {
            comments: { _id: ObjectId("...") }
        }
    }
)
```

---

## Mission 4: 좋아요 시스템 (⭐⭐⭐)

### 4-1. 좋아요 추가

```javascript
db.posts.updateOne(
    { _id: ObjectId("...") },
    { $addToSet: { likes: "alice" } }
)
```

### 4-2. 좋아요 취소

```javascript
db.posts.updateOne(
    { _id: ObjectId("...") },
    { $pull: { likes: "alice" } }
)
```

### 4-3. 좋아요 개수 확인

```javascript
db.posts.findOne(
    { _id: ObjectId("...") },
    { likes: { $size: 1 } }
)
```

---

## Mission 5: 통계 및 분석 (⭐⭐⭐⭐)

### 5-1. 가장 인기 있는 포스트

```javascript
db.posts.aggregate([
    { $match: { published: true } },
    {
        $project: {
            title: 1,
            author: 1,
            views: 1,
            likesCount: { $size: "$likes" },
            commentsCount: { $size: "$comments" }
        }
    },
    { $sort: { views: -1 } },
    { $limit: 10 }
])
```

### 5-2. 저자별 통계

```javascript
db.posts.aggregate([
    {
        $group: {
            _id: "$author",
            postCount: { $sum: 1 },
            totalViews: { $sum: "$views" },
            avgViews: { $avg: "$views" }
        }
    },
    { $sort: { totalViews: -1 } }
])
```

### 5-3. 태그별 인기도

```javascript
db.posts.aggregate([
    { $unwind: "$tags" },
    {
        $group: {
            _id: "$tags",
            count: { $sum: 1 }
        }
    },
    { $sort: { count: -1 } },
    { $limit: 10 }
])
```

---

## Mission 6: 검색 기능 (⭐⭐⭐⭐)

### 6-1. 텍스트 인덱스 생성

```javascript
db.posts.createIndex({ title: "text", content: "text" })
```

### 6-2. 텍스트 검색

```javascript
db.posts.find(
    { $text: { $search: "mongodb tutorial" } },
    { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })
```

---

## Mission 7: 종합 프로젝트 (⭐⭐⭐⭐⭐)

### 7-1. 피드 생성

팔로우한 사람들의 최신 포스트 가져오기

```javascript
// 1. Alice가 팔로우하는 사람 찾기
var following = db.users.findOne({ username: "alice" }).followers

// 2. 팔로우하는 사람들의 포스트
db.posts.find({
    author: { $in: following },
    published: true
}).sort({ createdAt: -1 }).limit(20)
```

### 7-2. 추천 포스트

```javascript
// 사용자가 좋아한 포스트의 태그 기반 추천
db.posts.aggregate([
    // 사용자가 좋아한 포스트의 태그 수집
    { $match: { likes: "alice" } },
    { $unwind: "$tags" },
    { $group: { _id: "$tags" } },
    // 해당 태그의 다른 포스트 찾기
    {
        $lookup: {
            from: "posts",
            localField: "_id",
            foreignField: "tags",
            as: "recommended"
        }
    }
])
```

---

## 강사 가이드

### 수업 진행 팁

1. **단계별 구현** (120분)
   - Mission 1부터 순차적으로
   - 각 미션마다 테스트
   - 학생들이 직접 작성하도록 유도

2. **실무 패턴 강조** (20분)
   - 데이터 임베드 vs 참조
   - 인덱스 전략
   - 집계 파이프라인 활용

3. **성능 고려** (10분)
   - 적절한 인덱스 생성
   - 쿼리 최적화
   - explain() 활용

---

## 요약

### 완성된 블로그 시스템

- ✅ 사용자 관리
- ✅ 포스트 CRUD
- ✅ 댓글 시스템
- ✅ 좋아요 기능
- ✅ 통계 분석
- ✅ 검색 기능
- ✅ 피드 생성

### 학습한 MongoDB 기능

- Document 설계
- CRUD 작업
- 인덱스 생성
- Aggregation Pipeline
- 텍스트 검색
- $lookup (JOIN)

---

**축하합니다!** 6장 NoSQL 데이터베이스를 완료했습니다.
