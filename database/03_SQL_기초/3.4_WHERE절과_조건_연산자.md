# 3.4. WHERE 절과 조건 연산자

> WHERE 절을 사용하여 조건에 맞는 데이터만 필터링할 수 있다.

---

## 실습 준비

이 섹션에서는 **world 데이터베이스**를 사용합니다.

```sql
USE world;
```

---

## 1. WHERE 절이란?

`WHERE` 절은 테이블에서 **조건에 맞는 데이터만** 선택하는 필터입니다.

### 기본 구조

```sql
SELECT 컬럼명
FROM 테이블명
WHERE 조건;
```

**예시**:
```sql
-- 인구가 1억 이상인 국가만 조회
SELECT Name, Population
FROM country
WHERE Population >= 100000000;
```

---

## 2. 비교 연산자

### 2.1. 기본 비교 연산자

| 연산자 | 의미 | 예시 |
|--------|------|------|
| `=` | 같다 | `Population = 50000000` |
| `!=` 또는 `<>` | 같지 않다 | `Continent != 'Asia'` |
| `>` | 크다 | `Population > 10000000` |
| `<` | 작다 | `Population < 10000000` |
| `>=` | 크거나 같다 | `LifeExpectancy >= 80` |
| `<=` | 작거나 같다 | `GNP <= 10000` |

### 2.2. 예시

```sql
-- 대한민국 정보 조회
SELECT *
FROM country
WHERE Name = 'South Korea';

-- 평균 수명이 80세 이상인 국가
SELECT Name, LifeExpectancy
FROM country
WHERE LifeExpectancy >= 80;

-- 아시아가 아닌 국가
SELECT Name, Continent
FROM country
WHERE Continent != 'Asia'
LIMIT 10;
```

**결과 확인**:
```sql
-- 인구가 5천만 이상인 국가
SELECT Name AS 국가명, Population AS 인구
FROM country
WHERE Population >= 50000000
ORDER BY Population DESC;
```

---

## 3. 논리 연산자

여러 조건을 조합하여 더 정교한 필터링을 수행합니다.

### 3.1. AND (그리고)

**모든 조건이 참**일 때만 결과를 반환합니다.

```sql
-- 아시아에 속하고 인구가 1억 이상인 국가
SELECT Name, Continent, Population
FROM country
WHERE Continent = 'Asia' AND Population >= 100000000;
```

**결과**:
```
+-------------+-----------+------------+
| Name        | Continent | Population |
+-------------+-----------+------------+
| Bangladesh  | Asia      | 129155000  |
| China       | Asia      | 1277558000 |
| India       | Asia      | 1013662000 |
| Indonesia   | Asia      | 212107000  |
| Japan       | Asia      | 126714000  |
| Pakistan    | Asia      | 156483000  |
+-------------+-----------+------------+
```

### 3.2. OR (또는)

**조건 중 하나라도 참**이면 결과를 반환합니다.

```sql
-- 유럽 또는 북미에 속한 국가 (상위 10개)
SELECT Name, Continent
FROM country
WHERE Continent = 'Europe' OR Continent = 'North America'
LIMIT 10;
```

### 3.3. NOT (부정)

조건을 **반대로** 만듭니다.

```sql
-- 아시아가 아닌 국가 (상위 10개)
SELECT Name, Continent
FROM country
WHERE NOT Continent = 'Asia'
LIMIT 10;

-- 또는
SELECT Name, Continent
FROM country
WHERE Continent != 'Asia'
LIMIT 10;
```

### 3.4. 복합 조건

괄호 `()`를 사용하여 우선순위를 명확히 할 수 있습니다.

```sql
-- 아시아에서 인구 5천만 이상이거나, 유럽에서 인구 1천만 이상인 국가
SELECT Name, Continent, Population
FROM country
WHERE (Continent = 'Asia' AND Population >= 50000000)
   OR (Continent = 'Europe' AND Population >= 10000000)
ORDER BY Population DESC;
```

---

## 4. 범위 연산자

### 4.1. BETWEEN

값이 **특정 범위 안에 있는지** 확인합니다. 경계값 포함.

```sql
-- 평균 수명이 70세 이상 80세 이하인 국가
SELECT Name, LifeExpectancy
FROM country
WHERE LifeExpectancy BETWEEN 70 AND 80
ORDER BY LifeExpectancy DESC
LIMIT 10;

-- 위 쿼리는 다음과 같습니다
SELECT Name, LifeExpectancy
FROM country
WHERE LifeExpectancy >= 70 AND LifeExpectancy <= 80
ORDER BY LifeExpectancy DESC
LIMIT 10;
```

### 4.2. IN

값이 **목록 안에 포함**되어 있는지 확인합니다.

```sql
-- 대한민국, 일본, 중국 정보 조회
SELECT Name, Continent, Population
FROM country
WHERE Name IN ('South Korea', 'Japan', 'China');

-- 위 쿼리는 다음과 같습니다
SELECT Name, Continent, Population
FROM country
WHERE Name = 'South Korea'
   OR Name = 'Japan'
   OR Name = 'China';
```

**NOT IN**:
```sql
-- 아시아, 유럽이 아닌 대륙의 국가 (상위 10개)
SELECT Name, Continent
FROM country
WHERE Continent NOT IN ('Asia', 'Europe')
LIMIT 10;
```

---

## 5. 패턴 매칭 (LIKE)

문자열의 **일부가 일치**하는 데이터를 찾습니다.

### 5.1. 와일드카드

| 기호 | 의미 | 예시 |
|------|------|------|
| `%` | 0개 이상의 문자 | `'Ko%'` → Korea, Kosovo |
| `_` | 정확히 1개의 문자 | `'Japa_'` → Japan |

### 5.2. 예시

```sql
-- 이름이 'South'로 시작하는 국가
SELECT Name FROM country WHERE Name LIKE 'South%';
-- 결과: South Korea, South Africa

-- 이름에 'United'가 포함된 국가
SELECT Name FROM country WHERE Name LIKE '%United%';
-- 결과: United Arab Emirates, United Kingdom, United States

-- 이름이 정확히 5글자인 국가
SELECT Name FROM country WHERE Name LIKE '_____';
-- 결과: China, Egypt, India, Italy, Japan, Kenya, Libya, Malta, Nauru, Niger, Palau, Qatar, Samoa, Spain, Sudan, Syria, Tonga, Yemen

-- 이름이 'land'로 끝나는 국가
SELECT Name FROM country WHERE Name LIKE '%land';
-- 결과: Finland, Greenland, Iceland, Ireland, New Zealand, Poland, ...
```

### 5.3. LIKE 주의사항

- `%`와 `_`는 성능에 영향을 줄 수 있음 (특히 앞에 `%`가 있을 때)
- 대소문자 구분은 DBMS 설정에 따라 다름 (MySQL은 기본적으로 구분 안 함)

---

## 6. NULL 처리

### 6.1. IS NULL / IS NOT NULL

`NULL`은 "값이 없음"을 의미하며, **`=`로 비교할 수 없습니다**.

```sql
-- 잘못된 예
SELECT * FROM country WHERE IndepYear = NULL;  -- 작동하지 않음

-- 올바른 예
SELECT Name, IndepYear
FROM country
WHERE IndepYear IS NULL
LIMIT 10;

-- NULL이 아닌 경우
SELECT Name, IndepYear
FROM country
WHERE IndepYear IS NOT NULL
LIMIT 10;
```

### 6.2. NULL 실전 예시

```sql
-- 독립 연도가 기록되지 않은 국가
SELECT Name, Continent
FROM country
WHERE IndepYear IS NULL;

-- 평균 수명 데이터가 있는 국가만 조회
SELECT Name, LifeExpectancy
FROM country
WHERE LifeExpectancy IS NOT NULL
ORDER BY LifeExpectancy DESC
LIMIT 10;
```

---

## 7. 도시 데이터 활용 (city 테이블)

### 예시 1: 특정 국가의 도시

```sql
-- 대한민국의 모든 도시
SELECT Name, Population
FROM city
WHERE CountryCode = 'KOR'
ORDER BY Population DESC;
```

### 예시 2: 대도시 찾기

```sql
-- 인구 1천만 이상의 메가시티
SELECT Name, CountryCode, Population
FROM city
WHERE Population >= 10000000
ORDER BY Population DESC;
```

### 예시 3: 도시명 패턴

```sql
-- 이름이 'San'으로 시작하는 도시
SELECT Name, CountryCode, Population
FROM city
WHERE Name LIKE 'San%'
ORDER BY Population DESC
LIMIT 10;
```

---

## 8. 실전 예시

### 예시 1: 선진국 찾기

```sql
-- 평균 수명 75세 이상, GNP 1조 이상인 국가
SELECT Name, LifeExpectancy, GNP
FROM country
WHERE LifeExpectancy >= 75 AND GNP >= 1000000
ORDER BY GNP DESC;
```

### 예시 2: 특정 지역 국가

```sql
-- 동아시아 국가
SELECT Name, Region, Population
FROM country
WHERE Region = 'Eastern Asia'
ORDER BY Population DESC;
```

### 예시 3: 복잡한 조건

```sql
-- 아시아에서 인구 1억 이상이거나,
-- 유럽에서 평균 수명 80세 이상인 국가
SELECT Name, Continent, Population, LifeExpectancy
FROM country
WHERE (Continent = 'Asia' AND Population >= 100000000)
   OR (Continent = 'Europe' AND LifeExpectancy >= 80)
ORDER BY Population DESC;
```

---

## 실습 문제

이제 **sakila 데이터베이스**로 실습해봅시다.

```sql
USE sakila;
```

### 문제 1: 비교 연산자

다음 요구사항에 맞는 SQL을 작성하세요.

1. 대여료(`rental_rate`)가 4달러 이상인 영화의 제목과 대여료 조회 (상위 10개)
2. 상영시간(`length`)이 120분 미만인 영화 조회 (상위 10개)
3. 등급(`rating`)이 'PG-13'인 영화 조회 (상위 10개)

**예상 답**:
```sql
-- 1
SELECT title, rental_rate
FROM film
WHERE rental_rate >= 4.0
ORDER BY rental_rate DESC
LIMIT 10;

-- 2
SELECT title, length
FROM film
WHERE length < 120
ORDER BY length ASC
LIMIT 10;

-- 3
SELECT title, rating
FROM film
WHERE rating = 'PG-13'
LIMIT 10;
```

### 문제 2: 논리 연산자

다음 요구사항에 맞는 SQL을 작성하세요.

1. 등급이 'PG'이고 대여료가 3달러 이상인 영화 (상위 10개)
2. 등급이 'G' 또는 'PG'인 영화 (상위 10개)
3. 상영시간이 60분 미만이거나 180분 이상인 영화 (상위 10개)

**예상 답**:
```sql
-- 1
SELECT title, rating, rental_rate
FROM film
WHERE rating = 'PG' AND rental_rate >= 3.0
ORDER BY rental_rate DESC
LIMIT 10;

-- 2
SELECT title, rating
FROM film
WHERE rating = 'G' OR rating = 'PG'
LIMIT 10;

-- 3
SELECT title, length
FROM film
WHERE length < 60 OR length >= 180
ORDER BY length DESC
LIMIT 10;
```

### 문제 3: 패턴 매칭

다음 요구사항에 맞는 SQL을 작성하세요.

1. 제목에 'LOVE'가 포함된 영화 조회 (상위 10개)
2. 제목이 'THE'로 시작하는 영화 조회 (상위 10개)
3. 배우 성(`last_name`)이 'SON'으로 끝나는 배우 조회

**예상 답**:
```sql
-- 1
SELECT title FROM film WHERE title LIKE '%LOVE%' LIMIT 10;

-- 2
SELECT title FROM film WHERE title LIKE 'THE%' LIMIT 10;

-- 3
SELECT first_name, last_name
FROM actor
WHERE last_name LIKE '%SON';
```

### 문제 4: 복합 조건

다음 요구사항을 SQL로 작성하세요.

"등급이 'PG-13'인 영화 중에서 대여료가 2.99달러 이상 4.99달러 이하이고, 상영시간이 90분 이상인 영화"

(상위 10개만 조회)

**예상 답**:
```sql
SELECT title, rating, rental_rate, length
FROM film
WHERE rating = 'PG-13'
  AND rental_rate BETWEEN 2.99 AND 4.99
  AND length >= 90
ORDER BY rental_rate DESC, length DESC
LIMIT 10;
```

---

## 강사 가이드

### 핵심 포인트

1. **WHERE는 필터**: 조건에 맞는 행만 선택
2. **NULL 비교**: `IS NULL` / `IS NOT NULL` 사용
3. **AND vs OR**: AND는 모든 조건 만족, OR는 하나만 만족
4. **괄호 사용**: 복잡한 조건에서 우선순위 명확히
5. **LIKE 성능**: 앞에 `%`가 있으면 인덱스를 사용하지 못함

### 자주 하는 질문

**Q: `=` 대신 `==`를 쓰면 안 되나요?**
A: SQL에서는 `=`만 사용합니다. `==`는 프로그래밍 언어에서 사용하는 표현입니다.

**Q: `AND`와 `OR`를 같이 쓸 때 우선순위는?**
A: `AND`가 `OR`보다 우선순위가 높습니다. 헷갈리면 괄호를 사용하세요.

**Q: NULL인 값은 `!=` 비교에 포함되나요?**
A: 아니요. NULL은 모든 비교 연산에서 제외됩니다. `IS NULL`로 따로 확인해야 합니다.

### 데이터베이스 활용 전략

1. **world DB (강의 설명/예제)**
   - 단순하고 직관적인 데이터 (국가, 도시)
   - 개념 설명에 적합
   - 학생들이 쉽게 이해할 수 있는 도메인

2. **sakila DB (실습 문제)**
   - 실무에 가까운 DVD 렌탈 시스템
   - 영화, 배우, 고객 등 복잡한 관계
   - 실전 감각을 기를 수 있음

3. **수업 진행 팁**
   - 먼저 world DB로 개념 설명 및 시연
   - 이해를 확인한 후 sakila DB로 실습 문제 풀이
   - 학생들이 두 DB를 번갈아 사용하며 연습하도록 유도

### 실습 진행 팁

1. **단계별 연습**: 비교 → 논리 → 범위 → 패턴 순서
2. **결과 확인**: 각 쿼리 실행 후 결과가 예상과 맞는지 확인
3. **복잡한 조건**: 간단한 조건부터 시작해서 점진적으로 복잡하게
4. **데이터베이스 전환**: `USE world;` (강의) → `USE sakila;` (실습) 명확히 안내

---

## 요약

- **WHERE**: 조건에 맞는 데이터만 필터링
- **비교 연산자**: `=`, `!=`, `>`, `<`, `>=`, `<=`
- **논리 연산자**: `AND`, `OR`, `NOT`
- **범위 연산자**: `BETWEEN`, `IN`
- **패턴 매칭**: `LIKE` (`%`: 여러 문자, `_`: 한 문자)
- **NULL 처리**: `IS NULL`, `IS NOT NULL`
- **괄호**: 복잡한 조건에서 우선순위 명확히
- **쿼리 실행 순서**: `FROM` → `WHERE` → `SELECT`

**다음 단계**: ORDER BY와 LIMIT로 결과를 정렬하고 제한하는 방법을 배웁니다!
