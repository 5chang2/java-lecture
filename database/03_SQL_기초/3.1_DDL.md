# 3.1. DDL (CREATE, ALTER, DROP)

> DDL(Data Definition Language)을 사용하여 데이터베이스와 테이블의 구조를 정의하고 관리할 수 있다.

---

## 실습 준비

이 섹션에서는 다음 데이터베이스를 사용합니다:
- **world**: 개념 설명 및 예제
- **sakila**: 실습 문제 (구조 탐색)
- **test_db**: 직접 생성하여 DDL 실습

데이터베이스 설치 방법은 [1.4 개발 환경 설정](../01_데이터베이스_기초/1.4_개발_환경_설정.md)을 참고하세요.

---

## 1. DDL이란?

**DDL**(Data Definition Language)은 데이터베이스의 **구조를 정의**하는 언어입니다.

### DDL의 역할

데이터를 담을 **그릇(Database, Table)을 만들고 관리**합니다:
- **CREATE**: 데이터베이스/테이블 생성
- **ALTER**: 테이블 구조 수정
- **DROP**: 데이터베이스/테이블 삭제
- **TRUNCATE**: 테이블 데이터 초기화

**비유**: DDL은 건물의 설계도를 그리고, 건물을 짓고, 리모델링하고, 철거하는 작업입니다.

---

## 2. 데이터 타입 (Data Types)

테이블을 만들 때 각 컬럼의 **데이터 타입**을 지정해야 합니다.

### 2.1. 숫자 타입

| 데이터 타입 | 설명 | 예시 |
|------------|------|------|
| **INT** | 정수 (-21억 ~ 21억) | `user_id`, `age`, `quantity` |
| **BIGINT** | 큰 정수 | `account_number` |
| **TINYINT** | 작은 정수 (-128 ~ 127) | `status (0, 1, 2)` |
| **DECIMAL(p, s)** | 고정 소수점 (정확한 계산) | `price DECIMAL(10, 2)` |
| **DOUBLE** | 부동 소수점 | `gps_latitude` |

### 2.2. 문자열 타입

| 데이터 타입 | 설명 | 예시 |
|------------|------|------|
| **VARCHAR(n)** | 가변 길이 문자열 (최대 n자) | `email VARCHAR(100)` |
| **CHAR(n)** | 고정 길이 문자열 | `gender CHAR(1)` |
| **TEXT** | 긴 텍스트 | `description TEXT` |

### 2.3. 날짜/시간 타입

| 데이터 타입 | 설명 | 예시 |
|------------|------|------|
| **DATE** | 날짜만 | `'2025-10-17'` |
| **DATETIME** | 날짜 + 시간 | `'2025-10-17 14:30:00'` |
| **TIMESTAMP** | 날짜 + 시간 (자동 갱신) | `updated_at TIMESTAMP` |

---

## 3. CREATE DATABASE: 데이터베이스 생성

### 3.1. 기본 문법

```sql
CREATE DATABASE 데이터베이스명;
```

### 3.2. 한글 지원 데이터베이스 생성

```sql
-- UTF-8 인코딩으로 데이터베이스 생성 (한글 깨짐 방지)
CREATE DATABASE test_db
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- 데이터베이스 선택
USE test_db;
```

**핵심 포인트**:
- `CHARACTER SET utf8mb4`: UTF-8 인코딩 (한글, 이모지 지원)
- `COLLATE utf8mb4_unicode_ci`: 정렬 규칙 (대소문자 구분 없음)

### 3.3. 데이터베이스 확인

```sql
-- 모든 데이터베이스 목록 조회
SHOW DATABASES;

-- 현재 선택된 데이터베이스 확인
SELECT DATABASE();
```

---

## 4. CREATE TABLE: 테이블 생성

### 4.1. 기본 문법

```sql
CREATE TABLE 테이블명 (
    컬럼1 데이터타입 [제약조건],
    컬럼2 데이터타입 [제약조건],
    ...
);
```

### 4.2. 제약조건 (Constraints)

데이터의 **무결성**을 보장하는 규칙입니다.

| 제약조건 | 설명 | 예시 |
|---------|------|------|
| **PRIMARY KEY** | 기본 키 (고유 + NOT NULL) | `user_id INT PRIMARY KEY` |
| **NOT NULL** | NULL 값 불허 | `email VARCHAR(100) NOT NULL` |
| **UNIQUE** | 중복 값 불허 | `email VARCHAR(100) UNIQUE` |
| **DEFAULT** | 기본값 설정 | `active BOOLEAN DEFAULT TRUE` |
| **AUTO_INCREMENT** | 자동 증가 (정수만) | `id INT AUTO_INCREMENT` |
| **FOREIGN KEY** | 외래 키 (다른 테이블 참조) | `FOREIGN KEY (user_id) REFERENCES users(id)` |

### 4.3. 실습: customers 테이블 생성

```sql
-- test_db 선택
USE test_db;

-- 고객 정보 테이블 생성
CREATE TABLE customers (
    customer_id   INT             PRIMARY KEY AUTO_INCREMENT,
    first_name    VARCHAR(50)     NOT NULL,
    last_name     VARCHAR(50)     NOT NULL,
    email         VARCHAR(100)    NOT NULL UNIQUE,
    active        BOOLEAN         DEFAULT TRUE,
    created_at    TIMESTAMP       DEFAULT CURRENT_TIMESTAMP
);

-- 테이블 구조 확인
DESCRIBE customers;
-- 또는
SHOW COLUMNS FROM customers;
```

**결과 예시**:
```
+-------------+--------------+------+-----+-------------------+
| Field       | Type         | Null | Key | Default           |
+-------------+--------------+------+-----+-------------------+
| customer_id | int          | NO   | PRI | NULL              |
| first_name  | varchar(50)  | NO   |     | NULL              |
| last_name   | varchar(50)  | NO   |     | NULL              |
| email       | varchar(100) | NO   | UNI | NULL              |
| active      | tinyint(1)   | YES  |     | 1                 |
| created_at  | timestamp    | YES  |     | CURRENT_TIMESTAMP |
+-------------+--------------+------+-----+-------------------+
```

### 4.4. world 데이터베이스 구조 탐색

```sql
-- world DB 선택
USE world;

-- 테이블 목록 조회
SHOW TABLES;

-- country 테이블 구조 확인
DESCRIBE country;
```

---

## 5. ALTER TABLE: 테이블 구조 수정

### 5.1. 컬럼 추가 (ADD COLUMN)

```sql
-- customers 테이블에 전화번호 컬럼 추가
ALTER TABLE customers
ADD COLUMN phone VARCHAR(20);

-- 확인
DESCRIBE customers;
```

### 5.2. 컬럼 수정 (MODIFY COLUMN)

```sql
-- phone 컬럼을 NOT NULL로 변경
ALTER TABLE customers
MODIFY COLUMN phone VARCHAR(20) NOT NULL;
```

### 5.3. 컬럼 이름 변경 (CHANGE COLUMN)

```sql
-- phone을 phone_number로 이름 변경
ALTER TABLE customers
CHANGE COLUMN phone phone_number VARCHAR(20) NOT NULL;
```

### 5.4. 컬럼 삭제 (DROP COLUMN)

```sql
-- phone_number 컬럼 삭제
ALTER TABLE customers
DROP COLUMN phone_number;
```

### 5.5. 제약조건 추가

```sql
-- 제약조건 추가 (예: CHECK 제약)
ALTER TABLE customers
ADD CONSTRAINT chk_email
CHECK (email LIKE '%@%');
```

---

## 6. DROP과 TRUNCATE

### 6.1. TRUNCATE: 데이터만 삭제

테이블 **구조는 유지**하고, **데이터만 모두 삭제**합니다.

```sql
-- customers 테이블의 모든 데이터 삭제 (구조는 유지)
TRUNCATE TABLE customers;
```

**특징**:
- DELETE보다 빠름
- AUTO_INCREMENT 값 초기화
- 롤백 불가능 (주의!)

### 6.2. DROP TABLE: 테이블 완전 삭제

테이블 **구조와 데이터를 모두 삭제**합니다.

```sql
-- 테스트 테이블 생성
CREATE TABLE test_table (
    id INT PRIMARY KEY,
    name VARCHAR(50)
);

-- 테이블 완전 삭제
DROP TABLE test_table;
```

⚠️ **경고**: 복구 불가능! 신중하게 사용하세요.

### 6.3. DROP DATABASE: 데이터베이스 삭제

```sql
-- 데이터베이스와 모든 테이블 삭제
DROP DATABASE test_db;
```

⚠️ **초강력 경고**: 모든 데이터가 영구 삭제됩니다!

---

## 실습 문제

### 문제 1: 데이터베이스 생성

`shop_db`라는 이름의 데이터베이스를 UTF-8 인코딩으로 생성하세요.

**예상 답**:
```sql
CREATE DATABASE shop_db
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

USE shop_db;
```

### 문제 2: 테이블 생성

다음 요구사항에 맞는 `products` 테이블을 생성하세요:
- `product_id`: 정수, 기본 키, 자동 증가
- `product_name`: 최대 100자 문자열, NOT NULL
- `price`: 소수점 2자리 (DECIMAL(10,2)), NOT NULL
- `stock`: 정수, 기본값 0
- `created_at`: 타임스탬프, 현재 시간 자동 입력

**예상 답**:
```sql
CREATE TABLE products (
    product_id    INT           PRIMARY KEY AUTO_INCREMENT,
    product_name  VARCHAR(100)  NOT NULL,
    price         DECIMAL(10,2) NOT NULL,
    stock         INT           DEFAULT 0,
    created_at    TIMESTAMP     DEFAULT CURRENT_TIMESTAMP
);
```

### 문제 3: 테이블 수정

1. `products` 테이블에 `category` 컬럼 추가 (VARCHAR(50), NOT NULL)
2. `stock` 컬럼을 `quantity`로 이름 변경

**예상 답**:
```sql
-- 1. 컬럼 추가
ALTER TABLE products
ADD COLUMN category VARCHAR(50) NOT NULL;

-- 2. 컬럼 이름 변경
ALTER TABLE products
CHANGE COLUMN stock quantity INT DEFAULT 0;
```

### 문제 4: sakila DB 구조 탐색

다음 질문에 답하세요:

1. sakila DB에는 몇 개의 테이블이 있나요?
2. `film` 테이블의 구조를 확인하세요.
3. `film` 테이블의 기본 키는 무엇인가요?

**예상 답**:
```sql
-- 1. 테이블 목록 조회
USE sakila;
SHOW TABLES;

-- 2. film 테이블 구조 확인
DESCRIBE film;

-- 3. film_id가 PRIMARY KEY임을 확인
```

### 문제 5: 테이블 정리

1. `products` 테이블의 모든 데이터를 삭제하되, 구조는 유지하세요.
2. 그 후 `products` 테이블을 완전히 삭제하세요.

**예상 답**:
```sql
-- 1. 데이터만 삭제 (구조 유지)
TRUNCATE TABLE products;

-- 2. 테이블 완전 삭제
DROP TABLE products;
```

---

## 강사 가이드

### 핵심 포인트

1. **DDL은 구조 정의**: 데이터가 아닌 틀을 만드는 작업
2. **제약조건의 중요성**: 데이터 무결성 보장
3. **데이터 타입 선택**: 적절한 타입으로 저장 공간 효율화
4. **DROP 주의**: 복구 불가능한 명령어, 신중하게 사용

### 데이터베이스 활용 전략

1. **world DB (개념 설명)**
   - 구조 탐색으로 DDL 개념 이해
   - DESCRIBE로 실제 테이블 구조 확인
   - 읽기 전용

2. **test_db (DDL 실습)**
   - 학생들이 직접 생성
   - CREATE, ALTER, DROP 자유롭게 실습
   - 실수해도 안전한 환경

3. **sakila DB (구조 탐색)**
   - 실전 DB 구조 분석
   - 복잡한 테이블 관계 이해
   - 읽기 전용

### 수업 진행 팁

1. **이론 → 실습 순서**:
   ```
   1. DDL 개념 설명 (5분)
   2. world DB로 구조 탐색 (10분)
   3. test_db 생성 및 테이블 실습 (30분)
   4. sakila DB 구조 분석 (15분)
   ```

2. **실습 시나리오**:
   - 먼저 테이블 생성 → 컬럼 추가/수정 → 삭제
   - 제약조건 위반 시 에러 체험 (교육 목적)
   - TRUNCATE vs DROP 차이 실습

3. **customers 테이블 중요성**:
   - 3.2 DML에서 이 테이블 사용
   - 구조를 명확히 이해시키기
   - AUTO_INCREMENT 동작 확인

### 자주 하는 질문

**Q: VARCHAR와 CHAR의 차이가 무엇인가요?**
A: VARCHAR는 가변 길이로 실제 저장된 글자 수만큼만 공간을 차지합니다. CHAR는 고정 길이로 항상 지정된 크기만큼 공간을 차지합니다. 대부분의 경우 VARCHAR가 효율적입니다.

**Q: DECIMAL과 DOUBLE의 차이는?**
A: DECIMAL은 고정 소수점으로 금융 데이터처럼 정확한 계산이 필요할 때 사용합니다. DOUBLE은 부동 소수점으로 근사값이므로 과학 계산에 사용합니다.

**Q: PRIMARY KEY와 UNIQUE의 차이는?**
A: PRIMARY KEY는 테이블당 하나만 지정 가능하며 NOT NULL이 자동 적용됩니다. UNIQUE는 여러 개 지정 가능하며 NULL 값을 허용할 수 있습니다.

**Q: TRUNCATE와 DELETE의 차이는?**
A: TRUNCATE는 테이블 구조를 유지하고 모든 데이터를 빠르게 삭제하며, AUTO_INCREMENT를 초기화하고 롤백이 불가능합니다. DELETE는 조건부 삭제가 가능하고 롤백이 가능합니다.

**Q: 제약조건은 언제 추가하나요?**
A: CREATE TABLE 시 정의하거나, ALTER TABLE로 나중에 추가할 수 있습니다. 가능하면 테이블 생성 시 함께 정의하는 것이 좋습니다.

### 실습 진행 순서

1. **test_db 생성** (5분)
   ```sql
   CREATE DATABASE test_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   USE test_db;
   ```

2. **customers 테이블 생성** (10분)
   - 구조 설명
   - 제약조건 의미 설명
   - DESCRIBE로 확인

3. **ALTER 실습** (15분)
   - 컬럼 추가/수정/삭제
   - 실수 체험 (이미 존재하는 컬럼 추가 시 에러)

4. **sakila 탐색** (10분)
   - 테이블 목록 조회
   - film, actor 테이블 구조 확인

5. **정리** (5분)
   - TRUNCATE vs DROP 차이
   - 다음 섹션 예고 (3.2 DML)

---

## 요약

- **DDL**: 데이터베이스 구조 정의 언어
- **CREATE**: 데이터베이스/테이블 생성
- **ALTER**: 테이블 구조 수정 (ADD, MODIFY, CHANGE, DROP)
- **DROP**: 객체 완전 삭제 (복구 불가)
- **TRUNCATE**: 데이터만 삭제 (구조 유지)
- **데이터 타입**: 숫자(INT, DECIMAL), 문자열(VARCHAR, TEXT), 날짜(DATE, DATETIME, TIMESTAMP)
- **제약조건**: PRIMARY KEY, NOT NULL, UNIQUE, DEFAULT, AUTO_INCREMENT, FOREIGN KEY
- **test_db**: 3.2~3.8에서 계속 사용할 실습 DB

**다음 단계**: 3.2 DML에서 생성한 테이블에 데이터를 추가/수정/삭제하는 방법을 배웁니다!
