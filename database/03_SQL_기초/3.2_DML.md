# 3.2. DML (INSERT, UPDATE, DELETE)

> DML(Data Manipulation Language)을 사용하여 데이터를 추가, 수정, 삭제할 수 있다.

---

## 실습 준비

이 섹션에서는 **3.1에서 생성한 test_db**를 사용합니다.

```sql
USE test_db;
```

**참고:** test_db와 customers 테이블은 3.1 DDL 섹션에서 이미 생성했습니다.

---

## 1. INSERT: 데이터 추가

### 1.1. 기본 문법

```sql
INSERT INTO 테이블명 (컬럼1, 컬럼2, ...)
VALUES (값1, 값2, ...);
```

### 1.2. 단일 행 삽입

```sql
-- 새 고객 추가
INSERT INTO customers (first_name, last_name, email)
VALUES ('John', 'Doe', 'john.doe@email.com');

-- 확인
SELECT * FROM customers WHERE customer_id = LAST_INSERT_ID();
```

### 1.3. 여러 행 한 번에 삽입

```sql
INSERT INTO customers (first_name, last_name, email) VALUES
('Jane', 'Smith', 'jane.smith@email.com'),
('Mike', 'Johnson', 'mike.j@email.com'),
('Sarah', 'Williams', 'sarah.w@email.com');

-- 확인
SELECT * FROM customers;
```

---

## 2. UPDATE: 데이터 수정

### 2.1. 기본 문법

```sql
UPDATE 테이블명
SET 컬럼1 = 값1, 컬럼2 = 값2, ...
WHERE 조건;
```

⚠️ **중요**: `WHERE` 절을 **반드시** 지정하세요!

### 2.2. 단일 컬럼 수정

```sql
-- John Doe의 이메일 변경
UPDATE customers
SET email = 'john.new@email.com'
WHERE first_name = 'John' AND last_name = 'Doe';

-- 확인
SELECT * FROM customers WHERE first_name = 'John';
```

### 2.3. 여러 컬럼 동시 수정

```sql
-- Jane Smith의 정보 변경
UPDATE customers
SET email = 'jane.new@email.com',
    active = FALSE
WHERE first_name = 'Jane' AND last_name = 'Smith';
```

---

## 3. DELETE: 데이터 삭제

### 3.1. 기본 문법

```sql
DELETE FROM 테이블명
WHERE 조건;
```

⚠️ **중요**: `WHERE` 절 없으면 **모든 데이터가 삭제**됩니다!

### 3.2. 조건에 맞는 행 삭제

```sql
-- Mike Johnson 삭제
DELETE FROM customers
WHERE first_name = 'Mike' AND last_name = 'Johnson';

-- 확인
SELECT * FROM customers;
```

---

## 4. 안전한 DML 사용법

### 4.1. 항상 SELECT로 먼저 확인

```sql
-- 1단계: 어떤 데이터가 영향받을지 먼저 조회
SELECT * FROM customers WHERE active = FALSE;

-- 2단계: 확인 후 DELETE 실행
DELETE FROM customers WHERE active = FALSE;
```

### 4.2. 트랜잭션 사용 (권장)

```sql
-- 트랜잭션 시작
START TRANSACTION;

-- 데이터 수정
UPDATE customers SET active = FALSE WHERE customer_id = 1;

-- 확인
SELECT * FROM customers WHERE customer_id = 1;

-- 만족하면 확정, 아니면 취소
COMMIT;     -- 확정
-- ROLLBACK;  -- 취소
```

---

## 실습 문제

### 문제 1: INSERT

test_db.customers 테이블에 다음 고객을 추가하세요.
- 이름: David, Brown
- 이메일: david.b@email.com

**예상 답**:
```sql
USE test_db;
INSERT INTO customers (first_name, last_name, email)
VALUES ('David', 'Brown', 'david.b@email.com');
```

### 문제 2: UPDATE

John Doe의 active 상태를 FALSE로 변경하세요.

**예상 답**:
```sql
UPDATE customers
SET active = FALSE
WHERE first_name = 'John' AND last_name = 'Doe';
```

### 문제 3: DELETE

active가 FALSE인 모든 고객을 삭제하세요.

**예상 답**:
```sql
-- 1. 먼저 확인
SELECT * FROM customers WHERE active = FALSE;

-- 2. 삭제
DELETE FROM customers WHERE active = FALSE;
```

---

## 강사 가이드

### 데이터베이스 활용 전략

**이 섹션은 데이터 변경(DML)을 다루므로 특별한 접근법을 사용합니다:**

1. **test_db (데이터 변경 실습용)**
   - INSERT, UPDATE, DELETE 실습을 위한 별도 테스트 DB
   - 학생들이 자유롭게 데이터를 추가/수정/삭제 가능
   - 실수해도 안전한 환경

2. **sakila DB (읽기 전용 조회)**
   - SELECT 쿼리 연습용으로만 사용
   - 원본 데이터 보호
   - 실제 프로덕션 DB를 다루는 것처럼 신중하게 접근

3. **수업 진행 흐름**
   ```
   1. test_db 생성 및 테이블 설정
   2. INSERT/UPDATE/DELETE 실습 (test_db)
   3. sakila DB로 조회 연습 (읽기 전용)
   4. 안전한 DML 습관 강조
   ```

### 핵심 포인트

1. **WHERE 절 필수**: UPDATE/DELETE는 항상 WHERE와 함께
2. **SELECT로 먼저 확인**: 영향받을 데이터를 먼저 조회
3. **트랜잭션 활용**: 실수 방지
4. **sakila는 읽기 전용**: 별도 테스트 DB 사용
5. **안전 습관 형성**: 실수로 전체 데이터 삭제 방지 교육

### 실습 진행 팁

1. **test_db 생성**: 실습용 별도 DB (학생마다 독립적으로 생성)
2. **sakila는 조회만**: 원본 데이터 보호 강조
3. **트랜잭션 실습**: COMMIT/ROLLBACK 체험
4. **WHERE 누락 체험**: 안전한 환경에서 실수 경험 (교육 목적)

---

## 요약

- **INSERT**: 새로운 데이터 추가
- **UPDATE**: 기존 데이터 수정 (WHERE 필수)
- **DELETE**: 데이터 삭제 (WHERE 필수)
- **안전 수칙**: SELECT 먼저 → 트랜잭션 → COMMIT
- **sakila DB**: 조회 연습용으로 활용
