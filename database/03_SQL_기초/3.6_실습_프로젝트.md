# 3.6. 실습: SQL 기초 종합 프로젝트

> SQL 기초 문법을 종합하여 실전 데이터베이스를 설계하고 쿼리를 작성할 수 있다.

---

## 1. 프로젝트 개요

**주제**: 온라인 쇼핑몰 상품 관리 시스템

이 실습에서는 3장에서 배운 모든 내용을 종합적으로 적용합니다:
- SELECT 기본 문법
- WHERE 절과 조건 연산자
- ORDER BY, LIMIT
- INSERT, UPDATE, DELETE
- 집계 함수와 GROUP BY

---

## 2. 데이터베이스 설계

### 2.1. 요구사항

**상품 관리**
- 상품은 상품번호, 상품명, 카테고리, 가격, 재고, 등록일을 가진다
- 상품번호는 자동 증가
- 가격은 0 이상이어야 한다

**카테고리**
- 전자제품, 의류, 식품, 도서, 생활용품

### 2.2. 테이블 생성

```sql
-- 데이터베이스 생성
CREATE DATABASE shop_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE shop_system;

-- 상품 테이블
CREATE TABLE products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    product_name VARCHAR(100) NOT NULL,
    category VARCHAR(50) NOT NULL,
    price DECIMAL(10, 2) NOT NULL CHECK (price >= 0),
    stock INT DEFAULT 0 CHECK (stock >= 0),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 3. 샘플 데이터 삽입

### 3.1. 초기 데이터

```sql
INSERT INTO products (product_name, category, price, stock) VALUES
-- 전자제품
('노트북', '전자제품', 1200000, 15),
('스마트폰', '전자제품', 800000, 25),
('태블릿', '전자제품', 600000, 20),
('이어폰', '전자제품', 50000, 100),
('충전기', '전자제품', 25000, 80),

-- 의류
('티셔츠', '의류', 29000, 50),
('청바지', '의류', 59000, 30),
('운동화', '의류', 89000, 40),
('모자', '의류', 19000, 60),

-- 식품
('과자세트', '식품', 12000, 100),
('음료수', '식품', 2000, 200),
('라면박스', '식품', 15000, 80),

-- 도서
('SQL 입문서', '도서', 35000, 20),
('프로그래밍 기초', '도서', 42000, 15),
('데이터베이스 설계', '도서', 38000, 10),

-- 생활용품
('수건세트', '생활용품', 25000, 40),
('치약', '생활용품', 3000, 150),
('샴푸', '생활용품', 12000, 70);
```

---

## 4. 단계별 실습

### 4.1. 기본 조회 (SELECT)

#### 연습 1: 모든 상품 조회

```sql
SELECT * FROM products;
```

#### 연습 2: 특정 컬럼만 조회

```sql
-- 상품명과 가격만 조회
SELECT product_name, price FROM products;
```

#### 연습 3: 별칭 사용

```sql
SELECT
    product_name AS 상품명,
    category AS 카테고리,
    CONCAT(price, '원') AS 가격,
    stock AS 재고
FROM products;
```

---

### 4.2. 조건 필터링 (WHERE)

#### 연습 4: 가격 조건

```sql
-- 50만원 이상 상품
SELECT product_name, price
FROM products
WHERE price >= 500000;
```

#### 연습 5: 카테고리 필터링

```sql
-- 전자제품만 조회
SELECT product_name, price, stock
FROM products
WHERE category = '전자제품';
```

#### 연습 6: 복합 조건

```sql
-- 전자제품 중 가격이 100만원 이하인 상품
SELECT product_name, price
FROM products
WHERE category = '전자제품' AND price <= 1000000;
```

#### 연습 7: 범위 검색

```sql
-- 가격이 3만원~10만원 사이인 상품
SELECT product_name, price
FROM products
WHERE price BETWEEN 30000 AND 100000
ORDER BY price;
```

#### 연습 8: 패턴 매칭

```sql
-- 상품명에 '세트'가 포함된 상품
SELECT product_name, category, price
FROM products
WHERE product_name LIKE '%세트%';
```

---

### 4.3. 정렬과 제한 (ORDER BY, LIMIT)

#### 연습 9: 가격순 정렬

```sql
-- 가격이 비싼 순서대로
SELECT product_name, price
FROM products
ORDER BY price DESC;
```

#### 연습 10: 다중 정렬

```sql
-- 카테고리 순, 같은 카테고리 내에서는 가격 높은 순
SELECT product_name, category, price
FROM products
ORDER BY category ASC, price DESC;
```

#### 연습 11: TOP 5 조회

```sql
-- 재고가 많은 상위 5개 상품
SELECT product_name, stock
FROM products
ORDER BY stock DESC
LIMIT 5;
```

#### 연습 12: 페이지네이션

```sql
-- 1페이지: 상위 10개
SELECT product_name, price
FROM products
ORDER BY product_name
LIMIT 10 OFFSET 0;

-- 2페이지: 11~20번째
SELECT product_name, price
FROM products
ORDER BY product_name
LIMIT 10 OFFSET 10;
```

---

### 4.4. 데이터 조작 (INSERT, UPDATE, DELETE)

#### 연습 13: 신규 상품 추가

```sql
INSERT INTO products (product_name, category, price, stock)
VALUES ('무선마우스', '전자제품', 35000, 50);

-- 확인
SELECT * FROM products WHERE product_name = '무선마우스';
```

#### 연습 14: 여러 상품 동시 추가

```sql
INSERT INTO products (product_name, category, price, stock) VALUES
('키보드', '전자제품', 75000, 30),
('가방', '의류', 45000, 25),
('텀블러', '생활용품', 18000, 60);
```

#### 연습 15: 가격 변경

```sql
-- 무선마우스 가격을 30000원으로 변경
UPDATE products
SET price = 30000
WHERE product_name = '무선마우스';

-- 확인
SELECT product_name, price FROM products WHERE product_name = '무선마우스';
```

#### 연습 16: 재고 조정

```sql
-- 판매: 재고 감소
UPDATE products
SET stock = stock - 1
WHERE product_name = '스마트폰' AND stock > 0;

-- 입고: 재고 증가
UPDATE products
SET stock = stock + 20
WHERE product_name = '스마트폰';
```

#### 연습 17: 할인 이벤트

```sql
-- 의류 카테고리 10% 할인
UPDATE products
SET price = price * 0.9
WHERE category = '의류';

-- 확인
SELECT product_name, price FROM products WHERE category = '의류';
```

#### 연습 18: 상품 삭제

```sql
-- 테스트 상품 삭제
INSERT INTO products (product_name, category, price, stock)
VALUES ('테스트상품', '기타', 1000, 0);

DELETE FROM products WHERE product_name = '테스트상품';
```

---

### 4.5. 집계 함수 (GROUP BY)

#### 연습 19: 전체 통계

```sql
-- 전체 상품 수, 평균 가격, 총 재고
SELECT
    COUNT(*) AS 총상품수,
    ROUND(AVG(price), 0) AS 평균가격,
    SUM(stock) AS 총재고
FROM products;
```

#### 연습 20: 카테고리별 통계

```sql
SELECT
    category AS 카테고리,
    COUNT(*) AS 상품수,
    ROUND(AVG(price), 0) AS 평균가격,
    MAX(price) AS 최고가,
    MIN(price) AS 최저가,
    SUM(stock) AS 총재고
FROM products
GROUP BY category
ORDER BY 평균가격 DESC;
```

#### 연습 21: HAVING 사용

```sql
-- 평균 가격이 5만원 이상인 카테고리만 조회
SELECT
    category AS 카테고리,
    COUNT(*) AS 상품수,
    ROUND(AVG(price), 0) AS 평균가격
FROM products
GROUP BY category
HAVING AVG(price) >= 50000
ORDER BY 평균가격 DESC;
```

---

### 4.6. 실전 쿼리

#### 연습 22: 재고 부족 상품

```sql
-- 재고가 30개 이하인 상품 (재고 부족 경고)
SELECT
    product_name AS 상품명,
    category AS 카테고리,
    stock AS 재고,
    CASE
        WHEN stock = 0 THEN '품절'
        WHEN stock <= 10 THEN '긴급 발주 필요'
        WHEN stock <= 30 THEN '재고 부족'
        ELSE '정상'
    END AS 재고상태
FROM products
WHERE stock <= 30
ORDER BY stock ASC;
```

#### 연습 23: 인기 카테고리 TOP 3

```sql
-- 상품 수가 많은 카테고리 상위 3개
SELECT
    category AS 카테고리,
    COUNT(*) AS 상품수,
    SUM(stock) AS 총재고
FROM products
GROUP BY category
ORDER BY 상품수 DESC
LIMIT 3;
```

#### 연습 24: 고가 상품 목록

```sql
-- 각 카테고리에서 가장 비싼 상품
SELECT
    category AS 카테고리,
    product_name AS 상품명,
    price AS 가격
FROM products p1
WHERE price = (
    SELECT MAX(price)
    FROM products p2
    WHERE p1.category = p2.category
)
ORDER BY category;
```

#### 연습 25: 월별 등록 상품 수

```sql
SELECT
    YEAR(created_at) AS 연도,
    MONTH(created_at) AS 월,
    COUNT(*) AS 등록상품수
FROM products
GROUP BY YEAR(created_at), MONTH(created_at)
ORDER BY 연도, 월;
```

---

## 5. 종합 문제

### 문제 1: 재고 관리 리포트

다음 정보를 포함한 리포트를 작성하세요:
- 카테고리별 총 재고 가치 (가격 × 재고)
- 평균 재고 수량
- 카테고리당 상품 수

재고 가치가 높은 순서대로 정렬하세요.

**예상 답**:
```sql
SELECT
    category AS 카테고리,
    COUNT(*) AS 상품수,
    ROUND(AVG(stock), 1) AS 평균재고,
    SUM(price * stock) AS 총재고가치
FROM products
GROUP BY category
ORDER BY 총재고가치 DESC;
```

### 문제 2: 상품 추천 시스템

다음 조건에 맞는 상품을 추천하세요:
- 가격이 10만원 이하
- 재고가 20개 이상
- 전자제품 또는 도서 카테고리
- 가격이 낮은 순서대로 상위 5개

**예상 답**:
```sql
SELECT
    product_name AS 추천상품,
    category AS 카테고리,
    price AS 가격,
    stock AS 재고
FROM products
WHERE price <= 100000
  AND stock >= 20
  AND category IN ('전자제품', '도서')
ORDER BY price ASC
LIMIT 5;
```

### 문제 3: 카테고리별 가격 분포

각 카테고리에서 가격대별 상품 수를 조회하세요:
- 3만원 미만: 저가
- 3만원~10만원: 중가
- 10만원 이상: 고가

**예상 답**:
```sql
SELECT
    category AS 카테고리,
    SUM(CASE WHEN price < 30000 THEN 1 ELSE 0 END) AS 저가,
    SUM(CASE WHEN price BETWEEN 30000 AND 100000 THEN 1 ELSE 0 END) AS 중가,
    SUM(CASE WHEN price > 100000 THEN 1 ELSE 0 END) AS 고가
FROM products
GROUP BY category;
```

### 문제 4: 재고 회전율 분석

다음 작업을 수행하세요:

1. 재고가 50개 이하인 상품의 재고를 20% 증가
2. 재고가 100개 이상인 상품 중 가격이 5000원 이하인 상품을 10% 할인
3. 변경 후 상품 목록 조회

**예상 답**:
```sql
-- 1. 재고 증가
UPDATE products
SET stock = stock * 1.2
WHERE stock <= 50;

-- 2. 가격 할인
UPDATE products
SET price = price * 0.9
WHERE stock >= 100 AND price <= 5000;

-- 3. 확인
SELECT
    product_name,
    category,
    price,
    stock,
    CONCAT(ROUND(price * stock, 0), '원') AS 재고가치
FROM products
ORDER BY price * stock DESC;
```

---

## 6. 도전 과제

### 과제 1: 월별 신규 상품 트렌드

created_at을 활용하여 월별로 어떤 카테고리의 상품이 많이 추가되었는지 분석하세요.

**힌트**:
```sql
SELECT
    YEAR(created_at) AS 연도,
    MONTH(created_at) AS 월,
    category AS 카테고리,
    COUNT(*) AS 상품수
FROM products
GROUP BY YEAR(created_at), MONTH(created_at), category
ORDER BY 연도, 월, 상품수 DESC;
```

### 과제 2: 재고 부족 알림 시스템

재고가 부족한 상품에 대해 발주 수량을 계산하세요:
- 재고가 10개 미만: 100개 발주
- 재고가 10~30개: 50개 발주
- 나머지: 발주 불필요

**힌트**:
```sql
SELECT
    product_name,
    stock AS 현재재고,
    CASE
        WHEN stock < 10 THEN 100
        WHEN stock BETWEEN 10 AND 30 THEN 50
        ELSE 0
    END AS 발주수량,
    stock + CASE
        WHEN stock < 10 THEN 100
        WHEN stock BETWEEN 10 AND 30 THEN 50
        ELSE 0
    END AS 발주후재고
FROM products
ORDER BY 발주수량 DESC, stock ASC;
```

### 과제 3: 베스트 셀러 카테고리 대시보드

카테고리별 핵심 지표를 한눈에 볼 수 있는 대시보드 쿼리를 작성하세요:
- 상품 수
- 평균 가격
- 총 재고 가치
- 평균 재고 수량

**힌트**:
```sql
SELECT
    category AS '카테고리',
    COUNT(*) AS '상품수',
    CONCAT(ROUND(AVG(price), 0), '원') AS '평균가격',
    CONCAT(ROUND(SUM(price * stock), 0), '원') AS '총재고가치',
    ROUND(AVG(stock), 1) AS '평균재고'
FROM products
GROUP BY category
ORDER BY SUM(price * stock) DESC;
```

---

## 강사 가이드

### 수업 진행 방법

**1단계: 환경 준비 (10분)**
- 데이터베이스 생성
- 테이블 생성
- 샘플 데이터 삽입

**2단계: 단계별 실습 (60분)**
- 기본 조회부터 시작
- 점진적으로 복잡한 쿼리로 확장
- 각 쿼리 실행 후 결과 확인

**3단계: 종합 문제 (30분)**
- 학생들이 독립적으로 문제 해결
- 어려운 부분은 힌트 제공

**4단계: 도전 과제 (20분)**
- 시간이 있는 학생들을 위한 추가 과제
- 실전 시나리오 기반

### 핵심 포인트

1. **단계별 진행**: 간단 → 복잡 순서
2. **결과 확인 습관**: 모든 쿼리 후 결과 체크
3. **실수 경험**: UPDATE/DELETE 시 WHERE 누락 체험 (안전 환경에서)
4. **실전 연결**: 실제 업무 시나리오와 연결

### 자주 하는 질문

**Q: 실습 데이터가 부족한데요?**
A: `INSERT INTO ... SELECT` 문으로 데이터를 복제할 수 있습니다.

**Q: 잘못 UPDATE/DELETE 했는데 되돌릴 수 있나요?**
A: 트랜잭션을 사용하면 ROLLBACK 가능합니다. 실습 전에 트랜잭션 시작을 권장합니다.

**Q: 실전에서는 이렇게 복잡한 쿼리를 자주 쓰나요?**
A: 네, 리포트 생성, 대시보드, 데이터 분석에서 자주 사용합니다.

### 실습 팁

1. **백업**: 실습 전 데이터 백업
```sql
CREATE TABLE products_backup AS SELECT * FROM products;
```

2. **트랜잭션 활용**:
```sql
START TRANSACTION;
-- 쿼리 실행
ROLLBACK;  -- 또는 COMMIT
```

3. **데이터 초기화**:
```sql
TRUNCATE TABLE products;
-- 샘플 데이터 다시 삽입
```

---

## 요약

이 실습에서 다룬 내용:

- ✅ **SELECT**: 데이터 조회, 별칭, DISTINCT
- ✅ **WHERE**: 비교, 논리, 범위, 패턴 연산자
- ✅ **ORDER BY**: 정렬 (단일, 다중)
- ✅ **LIMIT**: 결과 제한, 페이지네이션
- ✅ **INSERT**: 단일, 다중 행 삽입
- ✅ **UPDATE**: 조건부 수정, 계산 수정
- ✅ **DELETE**: 조건부 삭제
- ✅ **집계 함수**: COUNT, SUM, AVG, MAX, MIN
- ✅ **GROUP BY**: 그룹별 집계
- ✅ **HAVING**: 그룹 필터링
- ✅ **문자열 함수**: CONCAT, SUBSTRING
- ✅ **날짜 함수**: NOW, DATE, DATEDIFF
- ✅ **CASE**: 조건부 논리

**다음 단계**: 4장에서 JOIN을 배워 여러 테이블의 데이터를 결합하는 방법을 익힙니다!
