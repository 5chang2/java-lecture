# 2.5. 실습: 데이터베이스 설계 프로젝트

> 실제 시나리오를 바탕으로 ERD 작성부터 테이블 설계까지 전체 데이터베이스 설계 과정을 수행할 수 있다.

---

## 1. 프로젝트 개요

이 실습에서는 **도서관 관리 시스템**을 설계합니다. 지금까지 배운 모든 개념을 종합적으로 적용하는 프로젝트입니다.

### 적용할 개념
- ERD 작성 (개체, 속성, 관계)
- 테이블 관계 설정 (1:1, 1:N, N:M)
- 정규화 (1NF ~ 3NF)
- 제약 조건 식별 (PRIMARY KEY, FOREIGN KEY, UNIQUE, NOT NULL)

### 실습 도구
- **ERD 작성**: draw.io, Lucidchart, 종이와 펜
- **테이블 설계**: 엑셀 또는 구글 스프레드시트

**참고**: SQL 구문을 사용한 실제 구현은 3장에서 배웁니다. 이 섹션에서는 **설계**에 집중합니다.

---

## 2. 요구사항 분석

### 도서관 시스템 요구사항

**회원 관리**
- 회원은 회원번호, 이름, 이메일, 전화번호, 가입일 정보를 가진다
- 이메일은 중복될 수 없다
- 회원은 여러 권의 책을 대출할 수 있다

**도서 관리**
- 도서는 ISBN, 제목, 출판사, 출판일, 가격 정보를 가진다
- ISBN은 도서를 고유하게 식별한다
- 한 권의 책은 여러 저자가 쓸 수 있다
- 한 저자는 여러 권의 책을 쓸 수 있다

**저자 관리**
- 저자는 저자번호, 이름, 국적 정보를 가진다

**대출 관리**
- 대출은 대출번호, 대출일, 반납예정일, 실제반납일 정보를 가진다
- 한 대출 기록은 한 명의 회원과 한 권의 책에 대한 것이다
- 대출일은 자동으로 현재 날짜가 입력된다
- 반납예정일은 대출일로부터 14일 후이다

---

## 3. 단계별 설계 과정

### 3.1. 개체 식별

요구사항에서 **명사**를 찾아 개체를 식별합니다.

```
📦 개체(Entity)
- 회원 (Member)
- 도서 (Book)
- 저자 (Author)
- 대출 (Loan)
```

### 3.2. 속성 식별

각 개체의 **속성**을 나열합니다.

```
회원 (Member)
- 회원번호 (member_id) [PK]
- 이름 (name)
- 이메일 (email) [UNIQUE]
- 전화번호 (phone)
- 가입일 (join_date)

도서 (Book)
- ISBN [PK]
- 제목 (title)
- 출판사 (publisher)
- 출판일 (publish_date)
- 가격 (price)

저자 (Author)
- 저자번호 (author_id) [PK]
- 이름 (name)
- 국적 (nationality)

대출 (Loan)
- 대출번호 (loan_id) [PK]
- 대출일 (loan_date)
- 반납예정일 (due_date)
- 실제반납일 (return_date)
- 회원번호 (member_id) [FK]
- ISBN [FK]
```

### 3.3. 관계 식별

개체 간의 **관계**를 파악합니다.

```
관계 정의:
1. 회원 --- 대출 (1:N)
   - 한 회원은 여러 대출 기록을 가질 수 있다
   - 한 대출은 한 명의 회원에 속한다

2. 도서 --- 대출 (1:N)
   - 한 도서는 여러 번 대출될 수 있다
   - 한 대출은 한 권의 도서에 대한 것이다

3. 저자 --- 도서 (N:M)
   - 한 저자는 여러 도서를 집필할 수 있다
   - 한 도서는 여러 저자가 공동 집필할 수 있다
   → 중간 테이블 필요: book_authors
```

### 3.4. ERD 작성

Crow's Foot Notation으로 ERD를 표현합니다.

```
         1         N
Member |-------< Loan >-------| Book
                               |
                               |
                               | N
                               |
                       book_authors
                               |
                               | N
                               |
                            Author
```

**텍스트 기반 ERD 상세**:
```
[Member]
- member_id (PK)
- name
- email (UNIQUE)
- phone
- join_date

[Book]
- isbn (PK)
- title
- publisher
- publish_date
- price

[Author]
- author_id (PK)
- name
- nationality

[Loan]
- loan_id (PK)
- member_id (FK → Member)
- isbn (FK → Book)
- loan_date
- due_date
- return_date

[book_authors]
- book_author_id (PK)
- isbn (FK → Book)
- author_id (FK → Author)
- author_order (저자 순서)
```

---

## 4. 스프레드시트로 테이블 설계

ERD를 바탕으로 엑셀이나 구글 스프레드시트에 테이블 구조를 작성합니다.

### 4.1. 회원(Members) 테이블

| 컬럼명 | 데이터 타입 | 제약조건 | 설명 |
|--------|------------|---------|------|
| member_id | INT | PRIMARY KEY, AUTO_INCREMENT | 회원번호 (자동 증가) |
| name | VARCHAR(50) | NOT NULL | 이름 |
| email | VARCHAR(100) | NOT NULL, UNIQUE | 이메일 (중복 불가) |
| phone | VARCHAR(20) | - | 전화번호 |
| join_date | DATE | DEFAULT CURRENT_DATE | 가입일 (자동 입력) |

### 4.2. 저자(Authors) 테이블

| 컬럼명 | 데이터 타입 | 제약조건 | 설명 |
|--------|------------|---------|------|
| author_id | INT | PRIMARY KEY, AUTO_INCREMENT | 저자번호 (자동 증가) |
| name | VARCHAR(50) | NOT NULL | 이름 |
| nationality | VARCHAR(50) | - | 국적 |

### 4.3. 도서(Books) 테이블

| 컬럼명 | 데이터 타입 | 제약조건 | 설명 |
|--------|------------|---------|------|
| isbn | VARCHAR(13) | PRIMARY KEY | ISBN (13자리) |
| title | VARCHAR(200) | NOT NULL | 제목 |
| publisher | VARCHAR(100) | NOT NULL | 출판사 |
| publish_date | DATE | - | 출판일 |
| price | DECIMAL(10, 2) | CHECK (price >= 0) | 가격 (0 이상) |

### 4.4. 도서-저자(Book_Authors) 중간 테이블

**N:M 관계 해소를 위한 중간 테이블**

| 컬럼명 | 데이터 타입 | 제약조건 | 설명 |
|--------|------------|---------|------|
| book_author_id | INT | PRIMARY KEY, AUTO_INCREMENT | 관계 ID |
| isbn | VARCHAR(13) | FOREIGN KEY (Books), NOT NULL | 도서 ISBN |
| author_id | INT | FOREIGN KEY (Authors), NOT NULL | 저자번호 |
| author_order | INT | DEFAULT 1 | 저자 순서 (공동 저자) |

**추가 제약**:
- UNIQUE (isbn, author_id): 같은 책에 같은 저자 중복 방지

### 4.5. 대출(Loans) 테이블

| 컬럼명 | 데이터 타입 | 제약조건 | 설명 |
|--------|------------|---------|------|
| loan_id | INT | PRIMARY KEY, AUTO_INCREMENT | 대출번호 (자동 증가) |
| member_id | INT | FOREIGN KEY (Members), NOT NULL | 회원번호 |
| isbn | VARCHAR(13) | FOREIGN KEY (Books), NOT NULL | 도서 ISBN |
| loan_date | DATE | DEFAULT CURRENT_DATE | 대출일 (자동 입력) |
| due_date | DATE | NOT NULL | 반납예정일 |
| return_date | DATE | - | 실제반납일 (NULL 허용) |

**추가 제약**:
- CHECK (due_date > loan_date): 반납예정일은 대출일 이후
- CHECK (return_date IS NULL OR return_date >= loan_date): 실제반납일은 대출일 이후

---

## 5. 샘플 데이터 작성

스프레드시트에 샘플 데이터를 입력하여 설계를 검증합니다.

### 5.1. Members 시트

| member_id | name | email | phone | join_date |
|-----------|------|-------|-------|-----------|
| 1 | 김철수 | kim@email.com | 010-1234-5678 | 2025-01-01 |
| 2 | 이영희 | lee@email.com | 010-2345-6789 | 2025-01-05 |
| 3 | 박민수 | park@email.com | 010-3456-7890 | 2025-01-10 |

### 5.2. Authors 시트

| author_id | name | nationality |
|-----------|------|-------------|
| 1 | 박경리 | 한국 |
| 2 | 조정래 | 한국 |
| 3 | 헤밍웨이 | 미국 |
| 4 | 무라카미 하루키 | 일본 |

### 5.3. Books 시트

| isbn | title | publisher | publish_date | price |
|------|-------|-----------|--------------|-------|
| 9788936433598 | 토지 | 마로니에북스 | 2012-01-01 | 15000.00 |
| 9788936434489 | 태백산맥 | 한길사 | 2013-05-01 | 18000.00 |
| 9788937460012 | 노인과 바다 | 민음사 | 2012-03-01 | 12000.00 |
| 9788954620154 | 1Q84 | 문학동네 | 2014-07-01 | 20000.00 |

### 5.4. Book_Authors 시트

| book_author_id | isbn | author_id | author_order |
|----------------|------|-----------|--------------|
| 1 | 9788936433598 | 1 | 1 |
| 2 | 9788936434489 | 2 | 1 |
| 3 | 9788937460012 | 3 | 1 |
| 4 | 9788954620154 | 4 | 1 |

### 5.5. Loans 시트

| loan_id | member_id | isbn | loan_date | due_date | return_date |
|---------|-----------|------|-----------|----------|-------------|
| 1 | 1 | 9788936433598 | 2025-01-01 | 2025-01-15 | 2025-01-14 |
| 2 | 1 | 9788937460012 | 2025-01-10 | 2025-01-24 | (NULL) |
| 3 | 2 | 9788936434489 | 2025-01-05 | 2025-01-19 | (NULL) |
| 4 | 3 | 9788954620154 | 2025-01-08 | 2025-01-22 | (NULL) |

---

## 6. 실습 문제

### 문제 1: ERD 작성

다음 요구사항에 맞는 ERD를 작성하세요.

**요구사항**: 온라인 쇼핑몰 시스템
- 고객은 여러 개의 주문을 할 수 있다
- 한 주문에는 여러 상품이 포함될 수 있다
- 한 상품은 여러 주문에 포함될 수 있다
- 고객은 고객번호, 이름, 이메일을 가진다
- 상품은 상품번호, 상품명, 가격을 가진다
- 주문은 주문번호, 주문일, 총액을 가진다

**작성할 내용**:
1. 개체 식별 (최소 3개)
2. 속성 나열 (각 개체당 3개 이상)
3. 관계 식별 (최소 2개)
4. ERD 그리기 (텍스트 또는 도구 사용)

**예상 답**:
```
개체: 고객(Customer), 상품(Product), 주문(Order), 주문상세(OrderDetail)

관계:
- 고객 --- 주문 (1:N)
- 주문 --- 주문상세 (1:N)
- 상품 --- 주문상세 (1:N)
또는
- 주문 --- 상품 (N:M) → 주문상세로 해소
```

### 문제 2: 스프레드시트 테이블 설계

문제 1의 ERD를 바탕으로 스프레드시트에 테이블 구조를 작성하세요.

**작성할 테이블**:
1. Customers 테이블
2. Products 테이블
3. Orders 테이블
4. OrderDetails 테이블 (N:M 해소)

**각 테이블에 포함할 내용**:
- 컬럼명
- 데이터 타입
- 제약조건
- 설명

### 문제 3: 정규화 검증

도서관 시스템 설계가 3NF를 만족하는지 검증하세요.

**검증 항목**:
1. 모든 속성이 원자값인가? (1NF)
2. 부분 함수 종속이 없는가? (2NF)
3. 이행적 함수 종속이 없는가? (3NF)

**예상 답**:
```
✅ 1NF 만족: 모든 속성이 원자값
   - 전화번호, 이메일 등 모두 분리 불가능한 단일 값

✅ 2NF 만족: 모든 기본키가 단일 속성이므로 부분 함수 종속 없음
   - members: member_id
   - books: isbn
   - authors: author_id
   - loans: loan_id
   - book_authors: book_author_id

✅ 3NF 만족: 이행적 종속 없음
   - loans 테이블에서 member_id → member_name 같은 이행적 종속 없음
   - 모든 비키 속성이 기본키에만 종속
```

### 문제 4: 제약조건 식별

다음 시나리오에서 필요한 제약조건을 모두 나열하세요.

**시나리오**: 직원 관리 시스템
- 직원번호는 자동 증가
- 이메일은 중복 불가
- 나이는 18세 이상 65세 이하
- 부서번호는 부서 테이블을 참조
- 입사일은 자동으로 오늘 날짜

**예상 답**:
```
1. emp_id: PRIMARY KEY, AUTO_INCREMENT
2. email: UNIQUE, NOT NULL
3. age: CHECK (age >= 18 AND age <= 65)
4. dept_id: FOREIGN KEY (Departments)
5. hire_date: DEFAULT CURRENT_DATE
```

---

## 7. 도전 과제

### 과제 1: 예약 시스템 추가 설계

**요구사항**:
- 대출 중인 도서를 예약할 수 있는 기능 추가
- 예약은 선착순으로 처리

**작성할 내용**:
1. Reservations 테이블 설계 (스프레드시트)
2. 기존 ERD에 Reservations 개체 추가
3. 관계 설정 (Reservations ← → Members, Books)

### 과제 2: 복잡한 관계 설계

**시나리오**: 대학교 수강신청 시스템
- 학생은 여러 과목을 수강할 수 있다
- 한 과목은 여러 학생이 수강할 수 있다
- 한 과목은 한 명의 교수가 담당한다
- 한 교수는 여러 과목을 담당할 수 있다

**작성할 내용**:
1. ERD 작성 (개체, 속성, 관계)
2. 테이블 구조 설계 (스프레드시트)
3. N:M 관계 해소 전략
4. 정규화 검증

---

## 강사 가이드

### 수업 진행 방법

**1단계: 요구사항 분석 (20분)**
- 학생들과 함께 요구사항 읽기
- 개체, 속성, 관계를 함께 찾기
- 화이트보드에 ERD 스케치

**2단계: ERD 작성 (30분)**
- 도구 사용: draw.io, Lucidchart, 종이와 펜
- 관계 cardinality 명확히 표시
- N:M 관계 해소 과정 설명

**3단계: 스프레드시트 설계 (40분)**
- 엑셀 또는 구글 스프레드시트 사용
- 각 테이블을 별도 시트로 작성
- 컬럼명, 데이터 타입, 제약조건 명시

**4단계: 샘플 데이터 입력 (20분)**
- 설계 검증을 위한 샘플 데이터 작성
- 제약조건 위반 사례 확인 (예: 중복 이메일)
- 외래키 참조 관계 확인

### 핵심 포인트

1. **설계가 구현보다 중요**: SQL은 나중에 배우므로 설계에 집중
2. **스프레드시트 활용**: 시각적으로 테이블 구조 이해
3. **제약조건 명시**: PRIMARY KEY, FOREIGN KEY, UNIQUE 등 명확히 표시
4. **N:M 관계 해소**: 중간 테이블의 필요성 강조
5. **정규화 실습**: 실제 설계를 통해 정규화 개념 체득

### 스프레드시트 실습 팁

**시트 구성**:
- 시트1: ERD (텍스트 또는 이미지)
- 시트2: Members 테이블 구조
- 시트3: Authors 테이블 구조
- 시트4: Books 테이블 구조
- 시트5: Book_Authors 테이블 구조
- 시트6: Loans 테이블 구조
- 시트7: 샘플 데이터

**테이블 구조 시트 예시**:
```
A열: 컬럼명
B열: 데이터 타입
C열: 제약조건
D열: 설명
```

**샘플 데이터 시트**:
- 각 테이블별로 구분
- 실제 데이터 형식으로 입력
- 관계 확인 가능하도록 구성

### 자주 하는 질문

**Q: 왜 SQL로 바로 구현하지 않나요?**
A: 설계 단계에서 구조를 명확히 하는 것이 중요합니다. SQL 구문은 3장에서 배우므로, 지금은 논리적 설계에 집중합니다.

**Q: 스프레드시트로 충분한가요?**
A: 설계 단계에서는 충분합니다. 스프레드시트는 테이블 구조를 시각화하고 샘플 데이터를 입력하여 설계를 검증하기에 좋은 도구입니다.

**Q: ERD 도구를 꼭 사용해야 하나요?**
A: 아닙니다. 종이와 펜으로도 충분합니다. 중요한 것은 개체, 속성, 관계를 명확히 표현하는 것입니다.

**Q: 제약조건을 모두 표시해야 하나요?**
A: 네. 제약조건은 데이터 무결성을 보장하는 중요한 요소입니다. 설계 단계에서 명시해야 나중에 SQL로 구현할 때 누락되지 않습니다.

**Q: book_authors 테이블은 왜 필요한가요?**
A: N:M 관계를 해소하기 위해서입니다. 한 책에 여러 저자, 한 저자가 여러 책을 쓸 수 있으므로 중간 테이블이 필요합니다.

### 실습 자료 준비

**학생들에게 제공할 자료**:
1. 요구사항 문서 (프린트 또는 PDF)
2. ERD 예시 (참고용)
3. 스프레드시트 템플릿 (테이블 구조 양식)
4. 실습 문제지

**평가 기준**:
- ERD 정확성 (개체, 속성, 관계)
- 테이블 구조 완성도 (컬럼, 타입, 제약조건)
- 정규화 적용 여부
- 샘플 데이터 타당성

---

## 요약

이 실습에서 다룬 내용:

- ✅ **요구사항 분석**: 명사 → 개체, 동사 → 관계
- ✅ **ERD 작성**: Crow's Foot Notation, N:M 관계 해소
- ✅ **테이블 설계**: 스프레드시트로 구조 명시
- ✅ **제약조건 식별**: PRIMARY KEY, FOREIGN KEY, UNIQUE, NOT NULL, CHECK, DEFAULT
- ✅ **샘플 데이터**: 설계 검증을 위한 데이터 작성
- ✅ **정규화 검증**: 1NF, 2NF, 3NF 만족 확인

**핵심 교훈**:
1. **설계가 구현보다 중요하다**: 논리적 설계를 완벽히 한 후 구현
2. **정규화를 통해 중복을 제거한다**: 데이터 무결성 보장
3. **제약조건으로 규칙을 명시한다**: 데이터 품질 보장
4. **관계를 명확히 한다**: 1:1, 1:N, N:M 관계 파악

**다음 단계**: 3장에서 SQL을 배워 설계한 테이블을 실제로 구현합니다!
