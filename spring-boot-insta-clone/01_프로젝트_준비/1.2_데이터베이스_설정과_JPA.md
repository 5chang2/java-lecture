# 1.2. 데이터베이스 설정과 JPA

프로젝트의 골격이 만들어졌으니, 이제 데이터를 저장하고 관리할 데이터베이스를 연동할 차례입니다. 우리는 널리 사용되는 관계형 데이터베이스인 **MySQL**을 사용하고, Spring Boot에서 데이터베이스와 상호작용하는 표준 기술인 **JPA(Java Persistence API)**에 대해 알아봅니다.

---

## 1. MySQL 의존성 추가

Spring Boot 애플리케이션이 MySQL 데이터베이스와 통신하기 위해서는 **MySQL JDBC 드라이버**가 필요합니다. `build.gradle` 파일에 의존성을 추가해 줍니다.

`build.gradle` 파일을 열고 `dependencies` 블록에 다음 한 줄을 추가하세요.

```gradle
dependencies {
    // ... 기존 의존성들

    // MySQL 드라이버 추가
    runtimeOnly 'com.mysql:mysql-connector-j'
}
```

- `runtimeOnly`는 이 라이브러리가 실행 시에만 필요하다는 것을 의미합니다.
- 만약 Spring Initializr에서 `H2 Database`를 추가했다면, 해당 라인(`testImplementation 'com.h2database:h2'`)은 삭제하거나 그대로 두어도 괜찮습니다. (테스트용으로 분리하여 사용 가능)

의존성을 추가한 후에는 반드시 Gradle 프로젝트를 새로고침하여 라이브러리를 다운로드해야 합니다.

---

## 2. 데이터베이스 연결 설정 (`application.properties`)

`src/main/resources/application.properties` 파일은 애플리케이션의 모든 설정을 관리하는 곳입니다. 여기에 MySQL 연결 정보를 추가합니다.

```properties
# ===== DATABASE CONFIG =====
# DataSource
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/insta_clone?serverTimezone=Asia/Seoul
spring.datasource.username=root
spring.datasource.password=YOUR_MYSQL_PASSWORD # 본인의 MySQL 비밀번호로 변경

# ===== JPA CONFIG =====
# JPA (Java Persistence API)
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
```

각 설정의 의미는 다음과 같습니다.

- **`spring.datasource.*`**: 데이터베이스 연결 정보
  - `driver-class-name`: 사용할 JDBC 드라이버 클래스.
  - `url`: 연결할 데이터베이스의 경로. `localhost:3306`은 내 컴퓨터의 MySQL을, `insta_clone`은 연결할 데이터베이스의 스키마(schema) 이름을 의미합니다.
  - `username` / `password`: MySQL 접속 계정 정보.

- **`spring.jpa.*`**: JPA 관련 설정
  - `hibernate.ddl-auto`: 애플리케이션 실행 시 JPA가 엔티티(Entity) 클래스를 보고 데이터베이스 테이블을 어떻게 처리할지 결정합니다.
    - `create`: 매번 기존 테이블을 삭제하고 새로 생성 (개발 초기)
    - `update`: 변경된 부분만 반영 (개발 중)
    - `validate`: 엔티티와 테이블이 일치하는지만 검증
    - `none`: 아무것도 하지 않음 (운영 환경)
  - `show-sql`: JPA가 실행하는 SQL 쿼리를 로그로 보여줍니다.
  - `format_sql`: SQL 로그를 보기 좋게 포맷팅합니다.
  - `database-platform`: 특정 데이터베이스의 고유한 SQL 문법(Dialect)을 지정합니다.

### ※ MySQL 스키마 생성

Spring Boot가 연결하려면 MySQL에 `insta_clone`이라는 데이터베이스 스키마가 미리 생성되어 있어야 합니다. MySQL 클라이언트에서 다음 명령어를 실행하세요.

```sql
CREATE DATABASE insta_clone CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```

---

## 3. Django와 비교 (`settings.py`)

Spring Boot의 `application.properties` 파일은 Django의 `settings.py` 파일과 같은 역할을 합니다. 특히 데이터베이스 설정은 `settings.py`의 `DATABASES` 변수와 직접적으로 비교할 수 있습니다.

**Django의 `settings.py`**
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'insta_clone',
        'USER': 'root',
        'PASSWORD': 'YOUR_MYSQL_PASSWORD',
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

- **Spring Data JPA**는 Django의 **ORM(Object-Relational Mapping)** 과 동일한 역할을 수행하는 기술 표준입니다. 둘 다 개발자가 SQL을 직접 다루지 않고, 객체(클래스)를 통해 데이터베이스를 조작할 수 있게 해줍니다.
- `spring.jpa.hibernate.ddl-auto` 설정은 Django의 `migrate` 명령어와 유사한 역할을 자동으로 수행해준다고 볼 수 있습니다. 하지만 운영 환경에서는 안전을 위해 `none`으로 두고 직접 스키마를 관리하는 것이 일반적입니다.
