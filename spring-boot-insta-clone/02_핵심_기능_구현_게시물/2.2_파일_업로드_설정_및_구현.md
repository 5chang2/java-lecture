# 2.2. 파일 업로드 설정 및 구현

인스타그램의 핵심은 이미지입니다. 이번에는 사용자가 업로드한 이미지를 서버의 특정 폴더에 저장하고, 웹 브라우저를 통해 해당 이미지에 접근할 수 있도록 경로를 설정하는 방법을 알아봅니다.

---

## 1. 파일 업로드 전략

웹 애플리케이션에서 파일을 처리하는 일반적인 전략은 다음과 같습니다.

1.  클라이언트(브라우저)가 서버로 이미지 파일을 전송합니다.
2.  서버는 전송받은 파일을 디스크의 특정 경로(예: `C:/uploads/`)에 저장합니다.
3.  데이터베이스에는 파일 자체가 아닌, 서버에 저장된 **파일의 경로** 또는 **파일 이름**만 저장합니다.
4.  클라이언트가 이미지를 요청하면, 서버는 저장된 경로를 기반으로 이미지를 찾아 제공합니다.

---

## 2. 파일 저장 경로 설정 (`application.properties`)

먼저, 이미지를 저장할 경로를 `application.properties` 파일에 정의합니다. 이렇게 하면 경로가 변경될 때 코드 수정 없이 설정 파일만 바꾸면 되므로 유지보수에 용이합니다.

```properties
# application.properties

# ... 기존 설정 ...

# ===== FILE UPLOAD CONFIG =====
file.upload-dir=C:/dev/uploads/
```

- **주의**: 경로 마지막에 반드시 `/` 또는 `\`를 붙여주세요.
- 이 경로는 실제 서버의 파일 시스템 경로입니다. 프로젝트 외부 경로를 사용하는 것이 일반적입니다.

---

## 3. 외부 폴더 리소스 매핑 (`WebMvcConfig`)

서버의 특정 폴더(예: `C:/dev/uploads/`)에 저장된 이미지를 브라우저가 `http://...` URL로 접근하게 하려면, 특정 URL 요청을 해당 파일 시스템 경로와 연결해주는 작업이 필요합니다.

`com.example.instaclone` 패키지 아래에 `config`라는 새 패키지를 만들고, `WebMvcConfig.java` 클래스를 생성합니다.

```java
package com.example.instaclone.config;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

    @Value("${file.upload-dir}")
    private String uploadDir;

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/images/**")
                .addResourceLocations("file:///" + uploadDir);
    }
}
```

- **`@Configuration`**: 이 클래스가 Spring의 설정 파일임을 나타냅니다.
- **`WebMvcConfigurer`**: Spring MVC의 웹 설정을 커스터마이징할 수 있게 해주는 인터페이스입니다.
- **`@Value("${file.upload-dir}")`**: `application.properties`에 정의한 `file.upload-dir` 값을 읽어와 `uploadDir` 변수에 주입합니다.
- **`addResourceHandlers`**: 리소스 핸들러를 추가하는 메서드입니다.
  - `registry.addResourceHandler("/images/**")`: URL이 `/images/`로 시작하는 모든 요청을 처리할 핸들러를 등록합니다.
  - `.addResourceLocations("file:///" + uploadDir)`: 위에서 지정한 `/images/**` URL 요청을 `file:///C:/dev/uploads/` 경로와 매핑합니다. 즉, 브라우저에서 `/images/my-photo.jpg`를 요청하면 서버는 `C:/dev/uploads/my-photo.jpg` 파일을 찾아 제공합니다.

---

## 4. Django와 비교 (`MEDIA_ROOT`, `MEDIA_URL`)

지금까지의 과정은 Django의 `settings.py`와 `urls.py`에서 미디어 파일 설정을 하는 것과 정확히 일치합니다.

**Django의 `settings.py`**
```python
# 사용자가 업로드한 파일을 저장할 실제 파일 시스템 경로
MEDIA_ROOT = BASE_DIR / 'uploads'

# 브라우저에서 미디어 파일에 접근할 때 사용할 URL
MEDIA_URL = '/media/'
```

**Django의 `urls.py` (프로젝트 레벨)**
```python
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    # ...
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

- Spring Boot의 `file.upload-dir` 프로퍼티는 Django의 **`MEDIA_ROOT`** 와 같습니다.
- `WebMvcConfig`에서 `addResourceHandler("/images/**")`로 설정한 URL 경로는 Django의 **`MEDIA_URL`** 과 같은 역할을 합니다.
- `addResourceLocations()`로 실제 경로와 URL을 매핑하는 로직은 Django의 `static()` 함수가 처리하는 로직과 동일한 개념입니다.

```