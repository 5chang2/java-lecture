# 2.4. 게시물 목록(Read)

게시물 작성 기능을 만들었으니, 이제 작성된 게시물들을 메인 페이지에 목록 형태로 보여주는 기능을 구현할 차례입니다. 데이터베이스에서 모든 게시물 데이터를 가져와, Thymeleaf 템플릿을 이용해 동적으로 HTML을 생성하는 과정을 알아봅니다.

---

## 1. DTO(Data Transfer Object) 생성

엔티티(Entity)는 데이터베이스 테이블과 직접 매핑되는 핵심 객체이므로, 서비스 계층 외부, 특히 뷰(View) 계층으로 직접 노출하는 것은 좋지 않습니다. 대신, 뷰에 필요한 데이터만을 담아 전달하는 **응답용 DTO**를 만드는 것이 좋은 설계입니다.

`com.example.instaclone.domain.dto` 패키지에 `PostResponse.java` 레코드(record)를 생성합니다.

```java
package com.example.instaclone.domain.dto;

import com.example.instaclone.domain.Post;

import java.time.LocalDateTime;

public record PostResponse(
        Long id,
        String content,
        String imageUrl,
        LocalDateTime createdAt
) {
    // 정적 팩토리 메서드
    public static PostResponse from(Post post) {
        return new PostResponse(
                post.getId(),
                post.getContent(),
                post.getImageUrl(),
                post.getCreatedAt()
        );
    }
}
```

- **`from(Post post)`**: `Post` 엔티티 객체를 `PostResponse` DTO 객체로 변환해주는 정적 팩토리 메서드입니다. 이런 변환 로직을 DTO 내부에 두면 서비스 코드의 가독성이 높아집니다.

---

## 2. 서비스 및 컨트롤러 로직 수정

데이터베이스에서 모든 게시물을 조회하여 `PostResponse` DTO 리스트로 변환하는 서비스 메서드와, 이 데이터를 모델에 담아 뷰로 전달하는 컨트롤러를 수정합니다.

#### 1) `PostService`에 목록 조회 메서드 추가

```java
// PostService.java

// ... imports ...
import java.util.List;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
public class PostService {

    // ... 기존 코드 ...

    public List<PostResponse> findAll() {
        List<Post> posts = postRepository.findAll();
        return posts.stream()
                .map(PostResponse::from)
                .collect(Collectors.toList());
    }
}
```

- `postRepository.findAll()`: Spring Data JPA가 기본으로 제공하는 메서드로, `post` 테이블의 모든 레코드를 조회하여 `List<Post>` 형태로 반환합니다.
- `.stream().map(PostResponse::from).collect(Collectors.toList())`: Java 스트림(Stream) API를 사용하여 `List<Post>`를 `List<PostResponse>`로 변환합니다.

#### 2) `HomeController` 수정

메인 페이지(`/`)를 처리하는 `HomeController`가 게시물 목록을 조회하여 뷰에 전달하도록 수정합니다.

```java
// HomeController.java

package com.example.instaclone.controller;

import com.example.instaclone.domain.dto.PostResponse;
import com.example.instaclone.service.PostService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import java.util.List;

@Controller
@RequiredArgsConstructor
public class HomeController {

    private final PostService postService;

    @GetMapping("/")
    public String home(Model model) {
        List<PostResponse> posts = postService.findAll();
        model.addAttribute("posts", posts);
        return "home"; // templates/home.html 을 렌더링
    }
}
```

- **`Model model`**: 컨트롤러에서 뷰로 데이터를 전달하는 역할을 하는 Spring의 객체입니다.
- `model.addAttribute("posts", posts)`: `posts`라는 이름으로 게시물 목록 데이터를 모델에 추가합니다. 이제 뷰 템플릿에서 `posts`라는 이름으로 이 데이터에 접근할 수 있습니다.
- `return "home"`: `templates/home.html`을 렌더링하도록 변경합니다.

---

## 3. 게시물 목록 뷰(View) 만들기

`src/main/resources/templates/` 경로에 `home.html` 파일을 생성하고, `th:each`를 사용하여 게시물 목록을 반복 출력합니다.

```html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Insta Clone</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <!-- 게시물 카드 반복 시작 -->
                <div th:each="post : ${posts}" class="card mb-4">
                    <img th:src="${post.imageUrl}" class="card-img-top" alt="Post Image">
                    <div class="card-body">
                        <p class="card-text" th:text="${post.content}"></p>
                        <p class="card-text"><small class="text-muted" th:text="${post.createdAt}"></small></p>
                    </div>
                </div>
                <!-- 게시물 카드 반복 끝 -->
            </div>
        </div>
    </div>
</body>
</html>
```

- **`th:each="post : ${posts}"`**: 컨트롤러에서 전달받은 `posts` 리스트를 순회하며 각 아이템을 `post` 변수에 담아 반복 실행합니다.
- **`${posts}`**: `model.addAttribute("posts", ...)`에서 사용한 키 이름과 동일해야 합니다.
- **`th:src="${post.imageUrl}"`**: `<img>` 태그의 `src` 속성값을 `post.imageUrl` 값으로 설정합니다.
- **`th:text="${post.content}"`**: `<p>` 태그의 텍스트 내용을 `post.content` 값으로 설정합니다.

이제 애플리케이션을 실행하고 `http://localhost:8080`에 접속하면, 작성했던 게시물들이 목록 형태로 나타나는 것을 확인할 수 있습니다.

---

## 4. Django와 비교 (템플릿 렌더링)

- **`model.addAttribute("posts", posts)`**는 Django 뷰에서 템플릿에 데이터를 전달하기 위해 **`context` 딕셔너리**를 만드는 것과 같습니다.
  ```python
  # Django views.py
  def post_list(request):
      posts = Post.objects.all()
      context = {'posts': posts}
      return render(request, 'home.html', context)
  ```

- Thymeleaf의 **`th:each="post : ${posts}"`**는 Django 템플릿의 **`{% for post in posts %}`** 루프와 정확히 동일한 기능입니다.

- `th:text`, `th:src` 등 Thymeleaf의 속성들은 Django 템플릿의 `{{ post.content }}`, `{{ post.image.url }}`과 같이 변수 값을 출력하는 역할을 합니다.
