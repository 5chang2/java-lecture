# 4.4. 프로필 페이지 구현

이번에는 특정 사용자의 프로필 정보와 해당 사용자가 작성한 모든 게시물을 한 페이지에서 보여주는 프로필 페이지를 구현합니다. URL 경로에 포함된 사용자 이름을 기반으로 동적으로 페이지를 생성하는 방법을 알아봅니다.

---

## 1. 프로필 페이지 로직 구현 (Controller, Service)

#### 1) `UserService`에 프로필 정보 조회 메서드 추가

사용자 이름(username)으로 `User`를 조회하는 메서드를 `UserService`에 추가합니다.

```java
// UserService.java

// ...
@Transactional(readOnly = true)
public User findByUsername(String username) {
    return userRepository.findByUsername(username)
            .orElseThrow(() -> new IllegalArgumentException(username + " 사용자를 찾을 수 없습니다."));
}
```

- `@Transactional(readOnly = true)`: 데이터 변경이 없는 순수 조회 기능이므로, 성능 최적화를 위해 `readOnly = true` 옵션을 추가합니다.

#### 2) `UserController`에 프로필 페이지 처리 메서드 추가

`/profile/{username}` 형태의 요청을 받아 처리하는 메서드를 `UserController`에 추가합니다.

```java
// UserController.java

// ...
@GetMapping("/profile/{username}")
public String profilePage(@PathVariable String username, Model model) {
    User user = userService.findByUsername(username);
    // User 엔티티를 직접 뷰에 전달하기보다는, 필요한 정보만 담은 DTO를 사용하는 것이 좋습니다.
    // 여기서는 간단하게 User 객체를 그대로 전달합니다.
    model.addAttribute("user", user);
    return "users/profile";
}
```

- `@PathVariable String username`: URL 경로의 `{username}` 부분을 메서드의 파라미터로 받습니다.
- `model.addAttribute("user", user)`: 조회한 `User` 객체를 `user`라는 이름으로 모델에 담아 뷰로 전달합니다. `User` 엔티티는 `posts` 리스트를 양방향 관계로 가지고 있으므로, 이 `user` 객체를 통해 해당 사용자의 모든 게시물에 접근할 수 있습니다.

---

## 2. 프로필 페이지 뷰(View) 만들기

`templates/users/` 경로에 `profile.html` 파일을 생성합니다.

```html
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="|${user.username}님의 프로필|">프로필</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="container mt-4">
        <!-- 프로필 정보 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <!-- 프로필 이미지 (추후 구현) -->
                <img src="https://via.placeholder.com/150" class="img-fluid rounded-circle" alt="Profile Image">
            </div>
            <div class="col-md-9">
                <h2 th:text="${user.username}">Username</h2>
                <p>게시물 <strong th:text="${user.posts.size()}">0</strong></p>
                <!-- 팔로우/언팔로우 버튼 (추후 구현) -->
            </div>
        </div>

        <hr>

        <!-- 게시물 그리드 -->
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div th:each="post : ${user.posts}" class="col">
                <div class="card">
                    <img th:src="${post.imageUrl}" class="card-img-top" alt="Post Image">
                </div>
            </div>
        </div>
    </div>
</body>
</html>
```

- **`th:text="|${user.username}님의 프로필|"`**: Thymeleaf의 리터럴 대체(Literal substitution) 문법을 사용하여 동적으로 `<title>`을 생성합니다.
- **`th:text="${user.posts.size()}"`**: `User` 객체가 가진 `posts` 리스트의 크기를 가져와 게시물 수를 표시합니다. `@OneToMany`로 양방향 관계를 설정했기 때문에 가능합니다.
- **`th:each="post : ${user.posts}"`**: `user` 객체에 연관된 `posts` 리스트를 순회하며 각 게시물의 이미지를 그리드 형태로 보여줍니다.

이제 `http://localhost:8080/profile/사용자이름` 으로 접속하면 해당 사용자의 프로필 페이지가 나타납니다.

---

## 3. Django와 비교

- Spring의 `@PathVariable`은 Django `urls.py`의 경로 변수(e.g., `<str:username>`)와 동일한 역할을 합니다.

  ```python
  # Django urls.py
  path('profile/<str:username>/', views.profile_page, name='profile_page')
  ```

- 컨트롤러에서 `UserService`를 통해 `User` 객체를 조회하고, 이 객체를 통해 연관된 `posts` 목록까지 접근하는 방식은, Django 뷰에서 `User` 모델을 조회하고 템플릿에서 `user.post_set.all`과 같이 역참조를 통해 게시물 목록에 접근하는 방식과 개념적으로 동일합니다.

  ```python
  # Django views.py
  def profile_page(request, username):
      profile_user = User.objects.get(username=username)
      return render(request, 'profile.html', {'profile_user': profile_user})
  
  # Django profile.html
  # {% for post in profile_user.post_set.all %}
  #     <img src="{{ post.image.url }}">
  # {% endfor %}
  ```
