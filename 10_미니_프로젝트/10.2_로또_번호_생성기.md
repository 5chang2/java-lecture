# 10.2 미니 프로젝트: 로또 번호 생성기 & 당첨 확인

## 프로젝트 개요

로또 번호를 자동으로 생성하고, 당첨 번호와 비교하여 등수를 확인하는 프로그램입니다.

**로또 규칙**:
- 1~45 사이의 숫자 중 중복 없이 6개 선택
- 보너스 번호 1개 추가 (7번째 번호)
- 등수 기준:
  - 1등: 6개 일치
  - 2등: 5개 일치 + 보너스 번호 일치
  - 3등: 5개 일치
  - 4등: 4개 일치
  - 5등: 3개 일치
  - 낙첨: 2개 이하 일치

---

## 학습 목표

이 프로젝트를 통해 다음을 학습합니다:

- ✅ `Set` 컬렉션 활용 (중복 제거)
- ✅ `Collections.sort()` 정렬
- ✅ Stream API와 람다 표현식
- ✅ Enum을 이용한 상수 관리
- ✅ 객체 지향 설계 (클래스 분리)
- ✅ 비교 로직 구현

---

## JavaScript와의 비교

### JavaScript 버전 (참고)

```javascript
// JavaScript로 구현한 로또 생성기
class LottoGenerator {
  generateNumbers() {
    const numbers = new Set();
    while (numbers.size < 6) {
      const num = Math.floor(Math.random() * 45) + 1;
      numbers.add(num);
    }
    return Array.from(numbers).sort((a, b) => a - b);
  }

  checkWinning(myNumbers, winningNumbers, bonusNumber) {
    const matched = myNumbers.filter(num =>
      winningNumbers.includes(num)
    ).length;

    const hasBonus = myNumbers.includes(bonusNumber);

    if (matched === 6) return '1등';
    if (matched === 5 && hasBonus) return '2등';
    if (matched === 5) return '3등';
    if (matched === 4) return '4등';
    if (matched === 3) return '5등';
    return '낙첨';
  }
}
```

---

## Java 구현

### 1단계: Lotto 클래스 설계

```java
// Lotto.java
import java.util.*;

public class Lotto {
    private Set<Integer> numbers;  // 중복 방지를 위해 Set 사용

    // 생성자: 자동 생성
    public Lotto() {
        this.numbers = generateNumbers();
    }

    // 생성자: 수동 입력
    public Lotto(Set<Integer> numbers) {
        validateNumbers(numbers);
        this.numbers = new HashSet<>(numbers);
    }

    // 로또 번호 자동 생성
    private Set<Integer> generateNumbers() {
        Set<Integer> nums = new HashSet<>();
        Random random = new Random();

        while (nums.size() < 6) {
            int num = random.nextInt(45) + 1;  // 1~45
            nums.add(num);  // Set은 자동으로 중복 제거
        }

        return nums;
    }

    // 번호 검증
    private void validateNumbers(Set<Integer> numbers) {
        if (numbers == null) {
            throw new IllegalArgumentException("번호가 null일 수 없습니다.");
        }

        if (numbers.size() != 6) {
            throw new IllegalArgumentException("로또 번호는 정확히 6개여야 합니다.");
        }

        for (int num : numbers) {
            if (num < 1 || num > 45) {
                throw new IllegalArgumentException("번호는 1~45 사이여야 합니다.");
            }
        }
    }

    // 번호 가져오기
    public Set<Integer> getNumbers() {
        return new HashSet<>(numbers);  // 방어적 복사
    }

    // 정렬된 번호 리스트
    public List<Integer> getSortedNumbers() {
        List<Integer> sorted = new ArrayList<>(numbers);
        Collections.sort(sorted);
        return sorted;
    }

    // 특정 번호 포함 여부
    public boolean contains(int number) {
        return numbers.contains(number);
    }

    // 일치하는 번호 개수
    public int countMatches(Lotto other) {
        int count = 0;
        for (int num : this.numbers) {
            if (other.contains(num)) {
                count++;
            }
        }
        return count;
    }

    @Override
    public String toString() {
        return getSortedNumbers().toString();
    }
}
```

### 2단계: 등수 Enum 정의

```java
// LottoRank.java
public enum LottoRank {
    FIRST(6, false, "1등", 2_000_000_000),
    SECOND(5, true, "2등", 30_000_000),
    THIRD(5, false, "3등", 1_500_000),
    FOURTH(4, false, "4등", 50_000),
    FIFTH(3, false, "5등", 5_000),
    MISS(0, false, "낙첨", 0);

    private final int matchCount;
    private final boolean requireBonus;
    private final String description;
    private final int prize;

    LottoRank(int matchCount, boolean requireBonus, String description, int prize) {
        this.matchCount = matchCount;
        this.requireBonus = requireBonus;
        this.description = description;
        this.prize = prize;
    }

    // 등수 판정
    public static LottoRank valueOf(int matchCount, boolean hasBonus) {
        if (matchCount == 6) {
            return FIRST;
        }
        if (matchCount == 5 && hasBonus) {
            return SECOND;
        }
        if (matchCount == 5) {
            return THIRD;
        }
        if (matchCount == 4) {
            return FOURTH;
        }
        if (matchCount == 3) {
            return FIFTH;
        }
        return MISS;
    }

    public String getDescription() {
        return description;
    }

    public int getPrize() {
        return prize;
    }

    public String getPrizeFormatted() {
        if (prize == 0) {
            return "상금 없음";
        }
        return String.format("%,d원", prize);
    }
}
```

### 3단계: 당첨 확인 클래스

```java
// LottoMachine.java
import java.util.*;

public class LottoMachine {
    private Lotto winningLotto;
    private int bonusNumber;

    public LottoMachine(Lotto winningLotto, int bonusNumber) {
        this.winningLotto = winningLotto;
        this.bonusNumber = bonusNumber;
        validateBonusNumber();
    }

    private void validateBonusNumber() {
        if (bonusNumber < 1 || bonusNumber > 45) {
            throw new IllegalArgumentException("보너스 번호는 1~45 사이여야 합니다.");
        }
        if (winningLotto.contains(bonusNumber)) {
            throw new IllegalArgumentException("보너스 번호는 당첨 번호와 중복될 수 없습니다.");
        }
    }

    // 당첨 확인
    public LottoRank check(Lotto userLotto) {
        int matchCount = userLotto.countMatches(winningLotto);
        boolean hasBonus = userLotto.contains(bonusNumber);

        return LottoRank.valueOf(matchCount, hasBonus);
    }

    public Lotto getWinningLotto() {
        return winningLotto;
    }

    public int getBonusNumber() {
        return bonusNumber;
    }
}
```

### 4단계: 메인 프로그램

```java
// LottoGame.java
import java.util.*;

public class LottoGame {
    private Scanner scanner;

    public LottoGame() {
        this.scanner = new Scanner(System.in);
    }

    public void start() {
        System.out.println("===== 로또 번호 생성기 & 당첨 확인 =====\n");

        // 1. 사용자 로또 생성
        Lotto userLotto = createUserLotto();
        System.out.println("\n당신의 로또 번호: " + userLotto);

        // 2. 당첨 번호 생성 (실제로는 공개된 당첨 번호 입력)
        LottoMachine machine = createLottoMachine();
        System.out.println("\n당첨 번호: " + machine.getWinningLotto());
        System.out.println("보너스 번호: " + machine.getBonusNumber());

        // 3. 당첨 확인
        LottoRank rank = machine.check(userLotto);
        printResult(rank, userLotto, machine);

        scanner.close();
    }

    private Lotto createUserLotto() {
        System.out.println("1. 자동 생성");
        System.out.println("2. 수동 입력");
        System.out.print("선택: ");

        int choice = scanner.nextInt();
        scanner.nextLine();  // 버퍼 비우기

        if (choice == 1) {
            return new Lotto();
        } else {
            return createManualLotto();
        }
    }

    private Lotto createManualLotto() {
        System.out.print("6개의 번호를 입력하세요 (예: 1 2 3 4 5 6): ");
        String input = scanner.nextLine();
        String[] parts = input.trim().split("\\s+");

        Set<Integer> numbers = new HashSet<>();
        for (String part : parts) {
            numbers.add(Integer.parseInt(part));
        }

        return new Lotto(numbers);
    }

    private LottoMachine createLottoMachine() {
        System.out.print("\n당첨 번호 6개를 입력하세요: ");
        String input = scanner.nextLine();
        String[] parts = input.trim().split("\\s+");

        Set<Integer> winningNumbers = new HashSet<>();
        for (String part : parts) {
            winningNumbers.add(Integer.parseInt(part));
        }

        System.out.print("보너스 번호를 입력하세요: ");
        int bonusNumber = scanner.nextInt();

        return new LottoMachine(new Lotto(winningNumbers), bonusNumber);
    }

    private void printResult(LottoRank rank, Lotto userLotto, LottoMachine machine) {
        System.out.println("\n===== 당첨 결과 =====");

        // 일치하는 번호 표시
        Set<Integer> matched = new HashSet<>();
        for (int num : userLotto.getNumbers()) {
            if (machine.getWinningLotto().contains(num)) {
                matched.add(num);
            }
        }

        System.out.println("일치하는 번호: " + new ArrayList<>(matched));
        System.out.println("일치 개수: " + matched.size() + "개");

        boolean hasBonus = userLotto.contains(machine.getBonusNumber());
        if (hasBonus) {
            System.out.println("보너스 번호 일치!");
        }

        System.out.println("\n결과: " + rank.getDescription());
        System.out.println("상금: " + rank.getPrizeFormatted());
    }

    public static void main(String[] args) {
        LottoGame game = new LottoGame();
        game.start();
    }
}
```

---

## Stream API를 활용한 개선 버전

### Lotto 클래스 (Modern Java 버전)

```java
import java.util.*;
import java.util.stream.*;

public class Lotto {
    private Set<Integer> numbers;

    public Lotto() {
        this.numbers = generateNumbers();
    }

    public Lotto(Set<Integer> numbers) {
        validateNumbers(numbers);
        this.numbers = new HashSet<>(numbers);
    }

    // Stream을 이용한 번호 생성
    private Set<Integer> generateNumbers() {
        Random random = new Random();
        return random.ints(1, 46)  // 1~45 사이의 난수 스트림
                .distinct()         // 중복 제거
                .limit(6)          // 6개만
                .boxed()           // int -> Integer
                .collect(Collectors.toSet());
    }

    private void validateNumbers(Set<Integer> numbers) {
        if (numbers == null || numbers.size() != 6) {
            throw new IllegalArgumentException("로또 번호는 정확히 6개여야 합니다.");
        }

        boolean hasInvalidNumber = numbers.stream()
                .anyMatch(num -> num < 1 || num > 45);

        if (hasInvalidNumber) {
            throw new IllegalArgumentException("번호는 1~45 사이여야 합니다.");
        }
    }

    public List<Integer> getSortedNumbers() {
        return numbers.stream()
                .sorted()
                .collect(Collectors.toList());
    }

    public boolean contains(int number) {
        return numbers.contains(number);
    }

    // Stream을 이용한 일치 개수 계산
    public int countMatches(Lotto other) {
        return (int) this.numbers.stream()
                .filter(other::contains)
                .count();
    }

    @Override
    public String toString() {
        return getSortedNumbers().toString();
    }
}
```

---

## 실행 예시

```
===== 로또 번호 생성기 & 당첨 확인 =====

1. 자동 생성
2. 수동 입력
선택: 1

당신의 로또 번호: [3, 12, 23, 34, 38, 42]

당첨 번호 6개를 입력하세요: 3 12 23 34 38 40
보너스 번호를 입력하세요: 42

당첨 번호: [3, 12, 23, 34, 38, 40]
보너스 번호: 42

===== 당첨 결과 =====
일치하는 번호: [3, 12, 23, 34, 38]
일치 개수: 5개
보너스 번호 일치!

결과: 2등
상금: 30,000,000원
```

---

## 확장 아이디어

### Level 2: 여러 장 구매

```java
public class LottoGame {
    public void buyMultiple() {
        System.out.print("몇 장 구매하시겠습니까? ");
        int count = scanner.nextInt();

        List<Lotto> tickets = new ArrayList<>();
        for (int i = 0; i < count; i++) {
            tickets.add(new Lotto());
        }

        // 각 티켓별 당첨 확인
        for (int i = 0; i < tickets.size(); i++) {
            System.out.println("\n[" + (i + 1) + "번째 티켓]");
            LottoRank rank = machine.check(tickets.get(i));
            printResult(rank, tickets.get(i), machine);
        }
    }
}
```

### Level 3: 통계 기능

```java
public class LottoStatistics {
    private Map<LottoRank, Integer> statistics;

    public LottoStatistics() {
        this.statistics = new HashMap<>();
        for (LottoRank rank : LottoRank.values()) {
            statistics.put(rank, 0);
        }
    }

    public void addResult(LottoRank rank) {
        statistics.put(rank, statistics.get(rank) + 1);
    }

    public void printStatistics() {
        System.out.println("\n===== 당첨 통계 =====");
        for (LottoRank rank : LottoRank.values()) {
            if (rank == LottoRank.MISS) continue;
            System.out.printf("%s: %d회\n",
                rank.getDescription(),
                statistics.get(rank));
        }
    }

    public double calculateTotalProfit(int ticketPrice) {
        int totalSpent = statistics.values().stream()
                .mapToInt(Integer::intValue)
                .sum() * ticketPrice;

        int totalPrize = statistics.entrySet().stream()
                .mapToInt(entry ->
                    entry.getKey().getPrize() * entry.getValue())
                .sum();

        return ((double) totalPrize / totalSpent - 1) * 100;
    }
}
```

### Level 4: 번호 추천 기능

```java
public class LottoRecommender {
    // 가장 많이 나온 번호 분석
    public List<Integer> getHotNumbers(List<Lotto> history, int count) {
        Map<Integer, Long> frequency = history.stream()
                .flatMap(lotto -> lotto.getNumbers().stream())
                .collect(Collectors.groupingBy(
                    num -> num,
                    Collectors.counting()
                ));

        return frequency.entrySet().stream()
                .sorted(Map.Entry.<Integer, Long>comparingByValue().reversed())
                .limit(count)
                .map(Map.Entry::getKey)
                .collect(Collectors.toList());
    }
}
```

---

## 실습 문제

### 문제 1: 수익률 계산
로또를 여러 장 구매했을 때, 총 투자 금액과 당첨 금액을 비교하여 수익률을 계산하는 기능을 추가하세요.

**요구사항**:
- 로또 한 장 가격: 1,000원
- 수익률 = (당첨 금액 / 투자 금액) × 100

### 문제 2: 자동/수동 혼합 구매
자동 3장, 수동 2장과 같이 혼합 구매가 가능하도록 기능을 추가하세요.

### 문제 3: 당첨 번호 파일 저장
당첨 번호와 결과를 파일에 저장하고, 나중에 불러올 수 있는 기능을 구현하세요.

---

## 답안 예시

### 문제 1 답안

```java
public class LottoGame {
    private static final int TICKET_PRICE = 1000;

    public void buyMultipleWithProfit() {
        System.out.print("몇 장 구매하시겠습니까? ");
        int count = scanner.nextInt();
        scanner.nextLine();

        List<Lotto> tickets = new ArrayList<>();
        for (int i = 0; i < count; i++) {
            tickets.add(new Lotto());
        }

        // 당첨 확인 및 총 상금 계산
        int totalPrize = 0;
        for (int i = 0; i < tickets.size(); i++) {
            Lotto ticket = tickets.get(i);
            LottoRank rank = machine.check(ticket);

            System.out.printf("\n[%d번째 티켓] %s - %s\n",
                i + 1, ticket, rank.getDescription());

            totalPrize += rank.getPrize();
        }

        // 수익률 계산
        int totalInvestment = count * TICKET_PRICE;
        double profitRate = ((double) totalPrize / totalInvestment - 1) * 100;

        System.out.println("\n===== 결과 요약 =====");
        System.out.printf("투자 금액: %,d원\n", totalInvestment);
        System.out.printf("당첨 금액: %,d원\n", totalPrize);
        System.out.printf("수익률: %.2f%%\n", profitRate);

        if (profitRate > 0) {
            System.out.println("축하합니다! 수익이 발생했습니다!");
        } else if (profitRate == 0) {
            System.out.println("본전입니다.");
        } else {
            System.out.println("손실이 발생했습니다.");
        }
    }
}
```

### 문제 2 답안

```java
public class LottoGame {
    public void buyMixed() {
        System.out.print("자동 생성 개수: ");
        int autoCount = scanner.nextInt();

        System.out.print("수동 입력 개수: ");
        int manualCount = scanner.nextInt();
        scanner.nextLine();

        List<Lotto> tickets = new ArrayList<>();

        // 자동 생성
        for (int i = 0; i < autoCount; i++) {
            tickets.add(new Lotto());
        }

        // 수동 입력
        for (int i = 0; i < manualCount; i++) {
            System.out.printf("\n[수동 %d] 6개의 번호를 입력하세요: ", i + 1);
            Lotto manual = createManualLotto();
            tickets.add(manual);
        }

        // 결과 출력
        System.out.println("\n===== 구매한 로또 =====");
        for (int i = 0; i < tickets.size(); i++) {
            String type = i < autoCount ? "자동" : "수동";
            System.out.printf("[%s %d] %s\n",
                type,
                i < autoCount ? i + 1 : i - autoCount + 1,
                tickets.get(i));
        }
    }
}
```

---

## 핵심 개념 정리

### Java vs JavaScript 비교표

| 기능 | JavaScript | Java |
|------|-----------|------|
| 중복 제거 | `Set`, `new Set()` | `Set<Integer>`, `HashSet<>` |
| 정렬 | `array.sort()` | `Collections.sort()` |
| 난수 생성 | `Math.random()` | `Random.nextInt()` |
| 필터링 | `array.filter()` | `stream().filter()` |
| 개수 세기 | `array.length` | `stream().count()` |
| 상수 관리 | 객체 리터럴 | `enum` |

### 배운 Java 개념

1. **Set 컬렉션**: 중복 제거의 자동화
2. **Enum**: 등수를 타입 안전하게 관리
3. **Stream API**: 함수형 프로그래밍 스타일
4. **방어적 복사**: `new HashSet<>(numbers)`로 불변성 보장
5. **예외 처리**: `IllegalArgumentException`으로 입력 검증
6. **정적 팩토리 메서드**: `LottoRank.valueOf()`

---

## 강사 노트

### 수업 진행 팁

1. **단계적 구현** (4시간 분량):
   - 1단계 (40분): `Lotto` 클래스 - 번호 생성 및 검증
   - 2단계 (50분): `LottoRank` Enum - 등수 정의
   - 3단계 (60분): `LottoMachine` - 당첨 확인 로직
   - 4단계 (50분): `LottoGame` - 사용자 인터페이스
   - 5단계 (40분): Stream API로 리팩토링

2. **강조할 JavaScript와의 차이점**:
   - `Set`의 제네릭 타입 (`Set<Integer>`)
   - Enum의 강력함 (메서드, 필드 포함 가능)
   - Stream API의 함수형 스타일
   - 불변성과 방어적 복사의 중요성

3. **흔한 실수**:
   - `Set`에서 `get(index)` 호출 시도 (Set은 순서 없음)
   - `scanner.nextInt()` 후 버퍼 처리 누락
   - Enum 비교 시 `==` vs `equals()` 혼동

4. **디버깅 팁**:
   ```java
   // 생성된 번호 즉시 확인
   System.out.println("DEBUG - Generated: " + lotto.getSortedNumbers());
   ```

### Set vs List 선택 기준

**Set 사용 (이번 프로젝트)**:
- 중복을 자동으로 제거해야 할 때
- 순서가 중요하지 않을 때
- `contains()` 연산이 빈번할 때 (O(1))

**List 사용**:
- 순서가 중요할 때
- 인덱스로 접근해야 할 때
- 중복을 허용해야 할 때

### 학습자 수준별 조언

**초급자**:
- 먼저 `List`로 구현 후 `Set`으로 변경
- Enum 없이 상수(`static final`)로 시작

**중급자**:
- Stream API 적극 활용
- 여러 장 구매 기능 추가

**고급자**:
- 확률 계산 기능 (조합론)
- 과거 당첨 번호 분석 기능
