# 3.2 @RestController와 @RequestMapping

> **학습 목표**
> - @RestController와 @Controller의 차이를 이해합니다
> - @RestController로 간단한 REST API를 만들 수 있습니다
> - @RequestMapping의 다양한 속성을 활용할 수 있습니다
> - Postman으로 API를 테스트할 수 있습니다

---

## 1. @RestController란?

### 1.1 @Controller vs @RestController

**@Controller** (챕터 2):
```java
@Controller
public class UserController {

    @GetMapping("/users")
    public String list(Model model) {
        model.addAttribute("users", userService.findAll());
        return "user/list";  // ← View 이름 (HTML)
    }
}
```
→ **HTML 페이지** 반환

**@RestController** (이번 챕터):
```java
@RestController
public class UserApiController {

    @GetMapping("/api/users")
    public List<User> list() {
        return userService.findAll();  // ← 데이터 (JSON)
    }
}
```
→ **JSON 데이터** 반환

### 1.2 @RestController의 정체

**@RestController**는 다음의 조합입니다:

```java
@Controller + @ResponseBody
```

**즉**:
```java
// 이렇게 쓰는 대신
@Controller
public class UserApiController {

    @GetMapping("/api/users")
    @ResponseBody  // 모든 메서드에 필요
    public List<User> list() {
        return userService.findAll();
    }
}

// 이렇게 간결하게
@RestController  // 클래스 전체에 @ResponseBody 적용
public class UserApiController {

    @GetMapping("/api/users")
    public List<User> list() {
        return userService.findAll();
    }
}
```

---

## 2. 첫 번째 REST API 만들기

### 2.1 프로젝트 설정

**build.gradle** (이미 있음):
```groovy
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
}
```

`spring-boot-starter-web`에 **Jackson** 라이브러리 포함
→ 객체 ↔ JSON 자동 변환!

### 2.2 User 모델

**User.java**:
```java
package com.example.demo.model;

public class User {
    private Long id;
    private String name;
    private String email;
    private int age;

    // 생성자
    public User() {}

    public User(Long id, String name, String email, int age) {
        this.id = id;
        this.name = name;
        this.email = email;
        this.age = age;
    }

    // Getter, Setter (필수!)
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public int getAge() { return age; }
    public void setAge(int age) { this.age = age; }
}
```

### 2.3 UserApiController

**UserApiController.java**:
```java
package com.example.demo.controller;

import com.example.demo.model.User;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.List;

@RestController
@RequestMapping("/api/users")
public class UserApiController {

    // 임시 데이터
    private List<User> users = new ArrayList<>();
    private Long nextId = 1L;

    // 생성자에서 샘플 데이터 추가
    public UserApiController() {
        users.add(new User(nextId++, "홍길동", "hong@example.com", 25));
        users.add(new User(nextId++, "김철수", "kim@example.com", 30));
        users.add(new User(nextId++, "이영희", "lee@example.com", 28));
    }

    // 목록 조회
    @GetMapping
    public List<User> list() {
        return users;
    }

    // 상세 조회
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return users.stream()
            .filter(u -> u.getId().equals(id))
            .findFirst()
            .orElse(null);
    }
}
```

**코드 설명**:
- `@RestController`: JSON 반환
- `@RequestMapping("/api/users")`: 공통 경로
- `@GetMapping`: GET 요청 처리
- 반환값이 자동으로 JSON으로 변환됨!

### 2.4 실행 및 테스트

**서버 실행**:
```
Run Application.main()
```

**브라우저에서 테스트**:
```
http://localhost:8080/api/users
```

**결과** (JSON 자동 변환):
```json
[
  {
    "id": 1,
    "name": "홍길동",
    "email": "hong@example.com",
    "age": 25
  },
  {
    "id": 2,
    "name": "김철수",
    "email": "kim@example.com",
    "age": 30
  },
  {
    "id": 3,
    "name": "이영희",
    "email": "lee@example.com",
    "age": 28
  }
]
```

**특정 사용자 조회**:
```
http://localhost:8080/api/users/1
```

**결과**:
```json
{
  "id": 1,
  "name": "홍길동",
  "email": "hong@example.com",
  "age": 25
}
```

---

## 3. Postman으로 API 테스트

### 3.1 Postman이란?

- **API 테스트 도구**
- 브라우저보다 강력 (GET 외 POST, PUT, DELETE 테스트)
- 요청 저장, 공유 가능

### 3.2 Postman 사용법

**1. Postman 실행**

**2. 새 요청 만들기**:
```
New → HTTP Request
```

**3. GET 요청 테스트**:
```
메서드: GET
URL: http://localhost:8080/api/users
Send 클릭
```

**응답 확인**:
- Status: 200 OK
- Body: JSON 데이터

**4. PathVariable 테스트**:
```
메서드: GET
URL: http://localhost:8080/api/users/2
Send 클릭
```

**응답**:
```json
{
  "id": 2,
  "name": "김철수",
  "email": "kim@example.com",
  "age": 30
}
```

---

## 4. @RequestMapping 상세

### 4.1 기본 사용법

**클래스 레벨**:
```java
@RestController
@RequestMapping("/api/products")  // 공통 경로
public class ProductApiController {

    @GetMapping  // → /api/products
    public List<Product> list() {
        return productService.findAll();
    }

    @GetMapping("/{id}")  // → /api/products/123
    public Product getProduct(@PathVariable Long id) {
        return productService.findById(id);
    }
}
```

### 4.2 다양한 속성

**1. path (경로)**:
```java
@RequestMapping(path = "/api/users")
// 또는
@RequestMapping(value = "/api/users")
// 또는 (기본값)
@RequestMapping("/api/users")
```

**2. method (HTTP 메서드)**:
```java
@RequestMapping(value = "/api/users", method = RequestMethod.GET)
// 더 간결하게
@GetMapping("/api/users")
```

**3. params (쿼리 파라미터 조건)**:
```java
@GetMapping(value = "/api/users", params = "type=admin")
public List<User> getAdminUsers() {
    // /api/users?type=admin 만 처리
}
```

**4. headers (헤더 조건)**:
```java
@GetMapping(value = "/api/users", headers = "X-API-Version=1")
public List<User> getUsersV1() {
    // 헤더에 X-API-Version: 1 있어야 처리
}
```

**5. consumes (요청 Content-Type)**:
```java
@PostMapping(value = "/api/users", consumes = "application/json")
public User create(@RequestBody User user) {
    // Content-Type: application/json 만 처리
}
```

**6. produces (응답 Content-Type)**:
```java
@GetMapping(value = "/api/users", produces = "application/json")
public List<User> list() {
    // 응답 Content-Type을 application/json으로 명시
}
```

---

## 5. 다양한 요청 매핑

### 5.1 여러 경로 매핑

```java
@GetMapping({"/api/users", "/api/members"})
public List<User> list() {
    // /api/users 또는 /api/members 모두 처리
}
```

### 5.2 와일드카드 사용

```java
@GetMapping("/api/files/**")
public String getFile() {
    // /api/files/a
    // /api/files/a/b
    // /api/files/a/b/c
    // 모두 처리
}
```

### 5.3 정규식 사용

```java
@GetMapping("/api/users/{id:[0-9]+}")
public User getUser(@PathVariable Long id) {
    // /api/users/123 (O)
    // /api/users/abc (X - 404)
}
```

---

## 6. 응답 상태 코드 제어

### 6.1 @ResponseStatus

```java
@PostMapping
@ResponseStatus(HttpStatus.CREATED)  // 201
public User create(@RequestBody User user) {
    return userService.create(user);
}
```

### 6.2 ResponseEntity (더 강력)

```java
@GetMapping("/{id}")
public ResponseEntity<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);

    if (user == null) {
        return ResponseEntity.notFound().build();  // 404
    }

    return ResponseEntity.ok(user);  // 200
}
```

**다양한 응답**:
```java
// 200 OK
return ResponseEntity.ok(user);

// 201 Created
return ResponseEntity.status(HttpStatus.CREATED).body(user);

// 204 No Content
return ResponseEntity.noContent().build();

// 404 Not Found
return ResponseEntity.notFound().build();

// 400 Bad Request
return ResponseEntity.badRequest().body("Invalid input");
```

---

## 7. 실전 예제: 간단한 메모 API

### 7.1 Memo 모델

```java
public class Memo {
    private Long id;
    private String content;
    private LocalDateTime createdAt;

    public Memo() {
        this.createdAt = LocalDateTime.now();
    }

    public Memo(Long id, String content) {
        this.id = id;
        this.content = content;
        this.createdAt = LocalDateTime.now();
    }

    // Getter, Setter
}
```

### 7.2 MemoApiController

```java
@RestController
@RequestMapping("/api/memos")
public class MemoApiController {

    private List<Memo> memos = new ArrayList<>();
    private Long nextId = 1L;

    // 목록 조회
    @GetMapping
    public List<Memo> list() {
        return memos;
    }

    // 상세 조회
    @GetMapping("/{id}")
    public ResponseEntity<Memo> getMemo(@PathVariable Long id) {
        Memo memo = memos.stream()
            .filter(m -> m.getId().equals(id))
            .findFirst()
            .orElse(null);

        if (memo == null) {
            return ResponseEntity.notFound().build();
        }

        return ResponseEntity.ok(memo);
    }

    // 생성
    @PostMapping
    @ResponseStatus(HttpStatus.CREATED)
    public Memo create(@RequestBody Memo memo) {
        memo.setId(nextId++);
        memo.setCreatedAt(LocalDateTime.now());
        memos.add(memo);
        return memo;
    }

    // 삭제
    @DeleteMapping("/{id}")
    @ResponseStatus(HttpStatus.NO_CONTENT)
    public void delete(@PathVariable Long id) {
        memos.removeIf(m -> m.getId().equals(id));
    }
}
```

### 7.3 Postman 테스트

**1. 메모 생성** (POST):
```
메서드: POST
URL: http://localhost:8080/api/memos
Headers: Content-Type: application/json
Body (raw, JSON):
{
  "content": "Spring Boot 공부하기"
}

응답 (201 Created):
{
  "id": 1,
  "content": "Spring Boot 공부하기",
  "createdAt": "2024-01-15T10:30:00"
}
```

**2. 목록 조회** (GET):
```
메서드: GET
URL: http://localhost:8080/api/memos

응답 (200 OK):
[
  {
    "id": 1,
    "content": "Spring Boot 공부하기",
    "createdAt": "2024-01-15T10:30:00"
  }
]
```

**3. 상세 조회** (GET):
```
메서드: GET
URL: http://localhost:8080/api/memos/1

응답 (200 OK):
{
  "id": 1,
  "content": "Spring Boot 공부하기",
  "createdAt": "2024-01-15T10:30:00"
}
```

**4. 삭제** (DELETE):
```
메서드: DELETE
URL: http://localhost:8080/api/memos/1

응답 (204 No Content):
(본문 없음)
```

---

## 실습 문제

### 문제: 간단한 상품 API

**요구사항**:
1. 상품 모델 (id, name, price)
2. GET /api/products (목록)
3. GET /api/products/{id} (상세)
4. POST /api/products (생성)
5. DELETE /api/products/{id} (삭제)

<details>
<summary>답안 보기</summary>

```java
// Product.java
public class Product {
    private Long id;
    private String name;
    private int price;

    public Product() {}

    public Product(Long id, String name, int price) {
        this.id = id;
        this.name = name;
        this.price = price;
    }

    // Getter, Setter
}

// ProductApiController.java
@RestController
@RequestMapping("/api/products")
public class ProductApiController {

    private List<Product> products = new ArrayList<>();
    private Long nextId = 1L;

    @GetMapping
    public List<Product> list() {
        return products;
    }

    @GetMapping("/{id}")
    public ResponseEntity<Product> getProduct(@PathVariable Long id) {
        return products.stream()
            .filter(p -> p.getId().equals(id))
            .findFirst()
            .map(ResponseEntity::ok)
            .orElse(ResponseEntity.notFound().build());
    }

    @PostMapping
    @ResponseStatus(HttpStatus.CREATED)
    public Product create(@RequestBody Product product) {
        product.setId(nextId++);
        products.add(product);
        return product;
    }

    @DeleteMapping("/{id}")
    @ResponseStatus(HttpStatus.NO_CONTENT)
    public void delete(@PathVariable Long id) {
        products.removeIf(p -> p.getId().equals(id));
    }
}
```

**Postman 테스트**:
```
POST /api/products
{
  "name": "노트북",
  "price": 1000000
}

GET /api/products
DELETE /api/products/1
```

</details>

---

## 정리

### 핵심 요약

1. **@RestController**:
   - @Controller + @ResponseBody
   - JSON 자동 변환
   - HTML 대신 데이터 반환

2. **@RequestMapping**:
   - 클래스/메서드 레벨 사용
   - 다양한 속성 (path, method, params 등)

3. **Postman**:
   - API 테스트 도구
   - GET, POST, PUT, DELETE 모두 테스트 가능

4. **ResponseEntity**:
   - 상태 코드 제어
   - 헤더 추가 가능

### 다음 단계

다음 섹션에서는 HTTP 메서드별로 CRUD API를 완성합니다!

---

## 강사 가이드

### 강의 진행 팁

**1. 라이브 코딩**:
- Postman과 IDE를 나란히 배치
- API 작성 → 즉시 Postman으로 테스트
- 학생들이 결과를 바로 확인

**2. JSON 변환 마법 강조**:
- Getter만 있으면 자동 변환
- Jackson 라이브러리가 뒷단에서 처리
- 별도 설정 불필요

**3. 브라우저 vs Postman**:
- 브라우저는 GET만 가능
- Postman으로 POST, DELETE 시연
- 실무에서는 Postman 필수

### 예상 질문과 답변

**Q: Getter가 없으면?**
A: JSON 변환 시 해당 필드가 제외됩니다. Jackson은 Getter를 통해 값을 읽습니다.

**Q: @RestController와 @Controller를 섞어 쓸 수 있나요?**
A: 네, 가능합니다. 같은 프로젝트에서 풀스택(HTML)과 API(JSON)를 모두 제공할 수 있습니다.

**Q: Postman 대신 curl을 써도 되나요?**
A: 네, 가능합니다. 하지만 Postman이 GUI로 더 직관적입니다.

---

**[이전: 3.1 REST API 개념](./3.1_REST_API_개념.md)** | **[다음: 3.3 HTTP 메서드 활용](./3.3_HTTP_메서드_활용.md)**
